<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<link rel="icon" href="gio_circle_white_closeup2_512.png">
<link rel="apple-touch-icon" href="apple-icon.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="ì´ë¦„í‘œ">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="robots" content="noindex, nofollow">
<title>ì¸ìƒì€ ì´ë¦„í‘œ ë¶™ì´ê¸° ê²Œì„</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;600;700;900&family=Pretendard:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
<script src="https://accounts.google.com/gsi/client" async defer></script>
<style>
:root{
  --bg: #f7f5f0; --bg-card: #ffffff; --border: #e8e4dc; --border-l: #e5e2db;
  --tx: #1a1714; --tx-d: #4a453e; --tx-m: #8a8378; --tx-hint: #b0a898;
  --ac: #b08968; --ac-d: #8a6a48; --ac-light: #d1b69d;
  --red: #e06c6c; --yellow: #fbbf24; --r: 12px; --r-sm: 8px;
  --side-w: 280px; --list-w: 360px; --shadow: 0 2px 10px rgba(0,0,0,.05);
  
  /* í…Œë§ˆ ì»¬ëŸ¬ */
  --c-navi: #c4956a; --c-navi-bg: #fdf5ee;
  --c-500: #6a9a6a; --c-500-bg: #f0f7f0;
  --c-blog: #6a82a8; --c-blog-bg: #eef2f8;
  --c-book: #8a6a98; --c-book-bg: #f4eef8;
  --c-quote: #a09060; --c-quote-bg: #f8f5ec;
  --c-memo: #7a8a8a; --c-memo-bg: #eff3f3;
}

*{margin:0;padding:0;box-sizing:border-box; -webkit-tap-highlight-color: transparent;}
body{font-family:'Pretendard',sans-serif;background:var(--bg);color:var(--tx);min-height:100vh;overflow:hidden}

/* === ë¡œë”© & ë¡œê·¸ì¸ ìŠ¤í¬ë¦° === */
#lockScreen, #loadingScreen {position:fixed;inset:0;background:var(--bg);z-index:9999;display:flex;align-items:center;justify-content:center;flex-direction:column;transition:opacity 0.4s ease;}
#lockScreen.hidden, #loadingScreen.hidden {display:none;opacity:0;pointer-events:none;}
.lock-card{background:var(--bg-card);padding:40px 30px;border-radius:20px;box-shadow:var(--shadow);border:1px solid var(--border-l);display:flex;flex-direction:column;align-items:center;text-align:center;width:90%;max-width:320px;gap:12px;}
.lock-brand{font-family:'Noto Serif KR',serif;font-size:24px;font-weight:700;color:var(--tx);}
.lock-desc{font-size:14px;color:var(--tx-m);margin-bottom:12px;}
.lock-err{font-size:13px;color:var(--red);min-height:18px;font-weight:500;}

.loading-dots { display: flex; gap: 12px; margin-bottom: 24px; }
.loading-dots span { width: 14px; height: 14px; border-radius: 50%; display: inline-block; animation: dotBounce 1.4s infinite ease-in-out both; }
.loading-dots span:nth-child(1) { background: #FF5E5B; animation-delay: -0.32s; }
.loading-dots span:nth-child(2) { background: #FFC15E; animation-delay: -0.16s; }
.loading-dots span:nth-child(3) { background: #8EE386; animation-delay: 0s; }
.loading-dots span:nth-child(4) { background: #59C9EB; animation-delay: 0.16s; }
.loading-dots span:nth-child(5) { background: #C884F9; animation-delay: 0.32s; }
@keyframes dotBounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
.loading-cat { width: 130px; height: 130px; border-radius: 50%; border: 4px solid white; box-shadow: 0 8px 24px rgba(0,0,0,0.12); object-fit: cover; }

/* === ì „ì²´ ë ˆì´ì•„ì›ƒ (PC ê¸°ë³¸ ì„¤ì •) === */
.app{display:flex;height:100vh;}
.col-header{height:60px;min-height:60px;border-bottom:1px solid var(--border-l);display:flex;align-items:center;padding:0 20px;}
.mobile-nav-btn { display: none; background: none; border: none; cursor: pointer; margin-right: 12px; padding: 6px; border-radius: 8px; color: var(--tx-d); transition: .2s; }
.mobile-nav-btn:active { background: var(--bg-card); color: var(--tx); }
.mobile-nav-btn svg { width: 24px; height: 24px; stroke: currentColor; fill: none; stroke-width: 2.5; stroke-linecap: round; stroke-linejoin: round; }

/* === 1ë‹¨ ì‚¬ì´ë“œë°” (PCë²„ì „ - ê¹”ë”í•œ ë¦¬ìŠ¤íŠ¸ í˜•íƒœ) === */
.side { width: var(--side-w); min-width: var(--side-w); background: var(--bg); border-right: 1px solid var(--border); display: flex; flex-direction: column; overflow: hidden; z-index: 30; }
.header { display: flex; align-items: center; justify-content: space-between; padding: 16px 20px; background: var(--bg); position: sticky; top: 0; z-index: 10; border-bottom: 1px solid var(--border-l); }
.header-left { display: flex; align-items: center; gap: 10px; }
.avatar { width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 8px rgba(0,0,0,.08); object-fit: cover; border: 2px solid white; }
.brand { font-family: 'Noto Serif KR', serif; font-weight: 700; font-size: 16px; color: var(--tx); letter-spacing: -0.3px; }
.sync-status { font-size: 11px; color: var(--c-navi); display: flex; align-items: center; gap: 6px; font-weight: 600; cursor: pointer; padding: 4px 8px; border-radius: 12px; transition: 0.2s; }
.sync-status:active { background: rgba(0,0,0,0.05); }
.sync-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--c-navi); }

.side-scroll { flex: 1; overflow-y: auto; padding-bottom: 40px; }

/* PC ì–´êµ¬ë¡ */
.quote-section { padding: 20px 20px 10px; }
.quote-card { position: relative; background: #fdfcf8; border-radius: var(--r); padding: 20px 16px; cursor: pointer; transition: transform .2s; box-shadow: var(--shadow); border: 1px solid var(--border-l); border-left: 4px solid var(--c-quote); overflow: hidden; }
.quote-card:active { transform: scale(0.98); }
.quote-mark { display:none; } /* PCì—ì„  ìˆ¨ê¹€ */
.quote-label { font-size: 11px; font-weight: 700; color: var(--c-quote); margin-bottom: 8px; display: flex; align-items: center; gap: 4px; }
.quote-text { font-family: 'Noto Serif KR', serif; font-size: 14px; font-weight: 500; line-height: 1.6; color: var(--tx); margin-bottom: 8px; position: relative; z-index: 1; word-break: keep-all; }
.quote-by { font-size: 11px; color: var(--tx-m); font-family:'Pretendard', sans-serif;}

.section { padding: 0 20px; margin-bottom: 20px; }
.section-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; padding: 0 4px; }
.section-title { font-size: 11px; font-weight: 700; letter-spacing: 1px; text-transform: uppercase; color: var(--tx-hint); }

/* PC ê¸€ì“°ê¸° ë©”ë‰´ (ì„¸ë¡œ ë¦¬ìŠ¤íŠ¸) */
.writing-grid { display: flex; flex-direction: column; gap: 4px; }
.writing-item { background: transparent; border-radius: 8px; padding: 10px 12px; cursor: pointer; transition: .15s; display: flex; justify-content: space-between; align-items: center; border: 1px solid transparent;}
.writing-item:hover { background: var(--bg-card); border-color: var(--border-l); }
.writing-item.on { background: var(--bg-card); box-shadow: 0 2px 6px rgba(0,0,0,0.04); border-color: var(--border-l); }
.wi-name { font-size: 14px; font-weight: 600; color: var(--tx-d); }
.writing-item.on .wi-name { color: var(--tx); font-weight: 700; }
.wi-count { font-size: 13px; font-weight: 700; color: var(--tx-m); font-family: 'JetBrains Mono', monospace; background: var(--bg-card); padding: 2px 10px; border-radius: 12px; border: 1px solid var(--border-l); }
.writing-item.on .wi-count { background: var(--tx-d); color: white; border-color: var(--tx-d); }
.wi-arrow { display: none; } /* PCì—ì„  ìˆ¨ê¹€ */

/* PC ë°ì¼ë¦¬ ë£¨í‹´ (ì½¤íŒ©íŠ¸) */
.chk-table{display:flex;flex-direction:column;gap:4px;}
.chk-week-hdr{display:flex;justify-content:flex-end;padding:0 0 6px; border-bottom: 1px solid var(--border-l);} 
.chk-week-hdr .day-labels{display:flex;gap:4px;}
.chk-week-hdr .day-lbl{width:18px;text-align:center;font-size:10px;color:var(--tx-m);font-weight:600;}
.chk-row{display:flex;align-items:center;justify-content:space-between;padding:6px 0; border-bottom: 1px solid var(--border-l);}
.chk-row:last-child { border-bottom: none; }
.chk-left{display:flex;align-items:center;gap:10px;flex:1;cursor:pointer;}
.chk-box{width:18px;height:18px;border-radius:4px;border:2px solid var(--border);background:var(--bg-white);display:flex;align-items:center;justify-content:center;transition:0.2s;}
.chk-box.checked{background:var(--ac);border-color:var(--ac);}
.chk-box.checked::after{content:'';width:4px;height:8px;border:solid white;border-width:0 2px 2px 0;transform:rotate(45deg);margin-top:-2px;}
.chk-info { display: flex; align-items: center; gap: 8px; }
.chk-name { font-size: 13px; font-weight: 600; color: var(--tx-d); }
.chk-streak { font-size: 12px; font-weight: 700; font-family: 'JetBrains Mono', monospace; display: flex; align-items: center; gap: 2px; }
.chk-dots { display: flex; gap: 4px; align-items: center; }
.chk-dot { width: 18px; height: 18px; border-radius: 4px; background: var(--bg-white); border: 1px solid var(--border-l); cursor:pointer;}
.chk-dot.done { background: var(--ac-light); border-color: var(--ac-light); }
.chk-dot.today { box-shadow: inset 0 0 0 1.5px var(--ac); }

/* PC í†µê³„ ì¹´ë“œ */
.st-card { background: var(--bg-card); border-radius: 12px; padding: 16px; box-shadow: var(--shadow); border: 1px solid var(--border-l); margin-bottom: 12px; }
.st-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
.st-lb { font-size: 13px; color: var(--tx-d); font-weight: 700; }
.st-sub { display: flex; justify-content: space-between; gap: 6px; margin-top: 12px; }
.st-sub span { font-size: 11px; color: var(--tx-m); display: flex; flex-direction: column; align-items: center; gap: 4px; font-weight: 600;}
.st-sub b { color: var(--tx); font-size: 14px; font-weight: 700; font-family: 'JetBrains Mono', monospace; }
.st-bar { height: 4px; background: var(--bg); border-radius: 2px; margin-top: 14px; overflow: hidden; }
.st-bar-f { height: 100%; background: linear-gradient(90deg, #d1b69d, #b08968); transition: width .5s; }
.more-btn { font-size: 11px; color: var(--tx-m); background: var(--bg); border: none; padding: 4px 8px; border-radius: 8px; cursor: pointer; }
.book-mini { display: flex; justify-content: space-between; padding: 8px 0; font-size: 12px; border-bottom: 1px dashed var(--border-l); font-weight: 500; }
.book-mini:last-child { border-bottom: none; padding-bottom: 0; }
.book-mini-t { color: var(--tx-d); flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.book-mini-p { color: var(--c-book); font-family: 'JetBrains Mono', monospace; font-size: 11px; margin-left: 8px; font-weight: 700; }

/* === 2ë‹¨ ê¸€ ëª©ë¡ (PC ê¸°ë³¸) === */
.list-panel{width:var(--list-w);min-width:var(--list-w);background:var(--bg);border-right:1px solid var(--border);display:flex;flex-direction:column;overflow:hidden;position:relative;}
.lp-head{background:var(--bg);font-size:15px;font-weight:700;color:var(--tx); display: flex; align-items: center; padding: 0 20px; height: 60px; min-height: 60px; border-bottom: 1px solid var(--border-l);}
.lp-list{flex:1;overflow-y:auto;padding-bottom:100px;}

.lp-month-hdr { font-size: 13px; font-weight: 700; color: var(--tx-d); padding: 12px 20px 6px; background: var(--bg); position: sticky; top: 0; z-index: 5;}
.lp-item{display:flex;padding:16px 20px;cursor:pointer;border-bottom:1px solid var(--border-l);position:relative;gap:12px;align-items:flex-start;}
.lp-item:hover{background:var(--bg-card);}
.lp-item.on{background:var(--bg-card);box-shadow:inset 3px 0 0 var(--c-navi)}

.lp-date-wrap{display:flex;flex-direction:column;align-items:center;min-width:28px;}
.lp-date-dow{font-size:11px;color:var(--tx-hint);font-weight:600;}
.lp-date-day{font-size:20px;font-weight:700;color:var(--tx-d);line-height:1;margin-top:2px;font-family:'JetBrains Mono',monospace;}
.lp-item.on .lp-date-day{color:var(--tx);}

.lp-text-wrap{flex:1;min-width:0;display:flex;flex-direction:column;gap:4px;}
.lp-item-title{font-size:15px;font-weight:700;color:var(--tx);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.lp-item-preview{font-size:13px;color:var(--tx-d);overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;line-height:1.4;}
.lp-item-time{font-size:11px;color:var(--tx-hint);font-family:'Pretendard',sans-serif;margin-top:2px;}
.quote-txt {font-size:14px;font-family:'Noto Serif KR',serif;line-height:1.5;color:var(--tx);display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden; font-weight:500;}

.lp-item-actions { position: absolute; top: 16px; right: 16px; display: flex; gap: 4px; opacity: 0; transition: opacity 0.2s; }
.lp-item:hover .lp-item-actions { opacity: 1; }
.lp-action-btn { background: none; border: none; padding: 4px; width: 28px; height: 28px; cursor: pointer; color: var(--border-l); display: flex; align-items: center; justify-content: center; border-radius: 6px; }
.lp-action-btn:hover { background: var(--bg-card-h); color: var(--tx-m); }
.lp-action-btn.pin.on { opacity: 1; color: var(--yellow); }
.lp-action-btn.del:hover { color: var(--red); }
.lp-action-btn svg { width: 16px; height: 16px; stroke: currentColor; fill: none; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
.lp-action-btn.pin.on svg { fill: currentColor; }

.fab-btn { display: none; }

/* === 3ë‹¨ ì—ë””í„° (PC ê¸°ë³¸) === */
.editor{flex:1;display:flex;flex-direction:column;background:var(--bg-card);overflow:hidden;position:relative;}
.ed-topbar{background:var(--bg-card);position:relative;display:flex;justify-content:space-between; padding:0 30px; border-bottom: 1px solid var(--border-l); height: 60px; min-height: 60px; align-items:center;}
.ed-topbar-left{display:flex;align-items:center;gap:12px;}
.ed-save-status{font-size:12px;color:var(--tx-m);font-family:'JetBrains Mono',monospace;}
.ed-header-date{font-size:14px;font-weight:600;color:var(--tx-d);font-family:'Pretendard',sans-serif;}
.ed-topbar-right{display:flex;gap:12px;align-items:center;}
.ed-top-btn{padding:6px 16px;font-size:13px;font-weight:600;color:white;background:var(--ac);border:none;border-radius:16px;cursor:pointer;font-family:'Pretendard',sans-serif; white-space:nowrap;}
.ed-top-btn:active{opacity:.8}
.ed-btn-done{display:none;}

.toolbar{display:flex;align-items:center;padding:8px 30px;border-bottom:1px solid var(--border-l);background:var(--bg-card);gap:6px;flex-wrap:wrap;}
.tb-btn{width:32px;height:32px;display:flex;align-items:center;justify-content:center;background:none;border:1px solid transparent;border-radius:var(--r-sm);cursor:pointer;color:var(--tx-d);font-size:15px;font-weight:600;transition:.15s;font-family:'Pretendard',sans-serif}.tb-btn:hover{background:var(--bg);border-color:var(--border)}.tb-btn svg{width:18px;height:18px;stroke:currentColor;stroke-width:2;fill:none}
.tb-sep{width:1px;height:16px;background:var(--border);margin:0 6px}

.editor-scroll-area{flex:1;overflow-y:auto;display:flex;flex-direction:column;align-items:center;}
.editor-content-wrap{width:100%;max-width:800px;padding:40px 40px 100px 40px;display:flex;flex-direction:column;flex:1;}

.ed-title{width:100%;background:none;border:none;font-family:'Pretendard',sans-serif;font-size:28px;font-weight:700;color:var(--tx);outline:none;letter-spacing:-0.02em;margin-bottom:20px;line-height:1.3;}.ed-title::placeholder{color:var(--border-l)}
.ed-body{width:100%;min-height:100%;outline:none;font-family:'Pretendard',sans-serif;font-size:16px;line-height:1.8;letter-spacing:-0.01em;color:var(--tx);flex:1; word-break:keep-all;}.ed-body:empty::before{content:attr(data-placeholder);color:var(--border-l)}

.ed-body blockquote{border-left:4px solid var(--c-navi);padding:10px 16px;margin:16px 0;color:var(--tx-d);font-style:italic;background:var(--c-navi-bg); border-radius: 0 8px 8px 0;}
.ed-body h1,.ed-body h2,.ed-body h3{font-family:'Pretendard',sans-serif;margin:28px 0 12px;font-weight:700;letter-spacing:-0.02em;}.ed-body h1{font-size:22px}.ed-body h2{font-size:19px}.ed-body h3{font-size:16px}
.ed-body hr{border:none;border-top:1px solid var(--border);margin:28px 0}
.ed-body ul, .ed-body ol{padding-left:24px;margin:16px 0;}
.ed-body img { max-width: 100%; height: auto; display: block; margin: 1.5em auto; border-radius: 8px; box-shadow: var(--shadow); border: 1px solid var(--border); cursor: pointer; }

.ed-foot{padding:12px 20px; border-top:1px solid var(--border-l);background:var(--bg-card);display:flex;justify-content:center;gap:24px;font-size:12px;font-family:'Pretendard',sans-serif;color:var(--tx-m);font-weight:500;z-index:10;}.ed-foot span{color:var(--tx-d)}

.special-form{padding:20px 0;display:flex;flex-direction:column;gap:12px;border-bottom:1px solid var(--border);margin-bottom:20px;}
.sf-field{display:flex;flex-direction:column;gap:6px}.sf-row{display:flex;gap:16px}
.sf-label{font-size:12px;font-weight:600;color:var(--tx-m);letter-spacing:.5px}
.sf-input{width:100%;background:var(--bg);border:1px solid var(--border);border-radius:var(--r-sm);padding:10px 14px;font-size:15px;color:var(--tx);font-family:'Pretendard',sans-serif;outline:none}.sf-input::placeholder{color:var(--border-l)}.sf-input:focus{border-color:var(--c-navi);box-shadow:0 0 0 2px rgba(196,149,106,.2)}

::-webkit-scrollbar{width:8px;height:8px;}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--border-l);border-radius:4px}

.mob-tool-bar { display:none; }
.fs-overlay { display:none; }
.fs-sheet { display:none; }


/* ==========================================
   âœ¨ ëª¨ë°”ì¼ ìµœì í™” (í”„ë¡œí† íƒ€ì… ì ìš© êµ¬ê°„)
   ========================================== */
@media (max-width: 768px) {
  .app { position: relative; display: block; height: 100vh; height: 100dvh; overflow: hidden; width: 100vw; }
  
  .side { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-right: none; transition: transform 0.35s ease; background: var(--bg); z-index: 10; }
  .list-panel { position: absolute; top: 0; left: 0; width: 100%; height: 100%; transition: transform 0.35s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.35s; background: var(--bg); z-index: 20; transform: translateX(100%); }
  .editor { position:absolute; top:0; left:0; width:100%; height:100%; z-index:40; transform:translateX(100%); transition:transform 0.35s cubic-bezier(0.2,0.8,0.2,1); }
  
  .app.view-list .list-panel { transform: translateX(0); opacity: 1; }
  .app.view-list .side { transform: translateX(-30%); opacity: 0.5; }
  .app.view-editor .editor { transform:translateX(0); }
  .app.view-editor .list-panel { transform: translateX(0); opacity: 1; } /* ë‹¹ê²¨ì„œ ë‹«ê¸°í•  ë•Œ ë°°ê²½ìœ¼ë¡œ ìœ ì§€ */
  
  .mobile-nav-btn { display: flex; align-items: center; justify-content: center; margin-right:4px;}
  .mobile-back-btn { display: none !important; } 
  
  /* --- ëª¨ë°”ì¼ 1ë‹¨ (ì‚¬ì´ë“œë°”) ë³€ê²½ì  --- */
  .side-scroll { padding-bottom: 80px; }
  
  /* ëª¨ë°”ì¼ ì–´êµ¬ë¡ ê±°ëŒ€ ë”°ì˜´í‘œ */
  .quote-card { background: linear-gradient(135deg, #fdfcf8 0%, #f8f4ec 100%); padding: 24px 22px 20px; border-left: none; }
  .quote-mark { display:block; font-family: 'Georgia', serif; font-size: 80px; font-weight: 900; color: var(--c-quote); opacity: 0.1; line-height: 1; position: absolute; top: -10px; left: 16px; pointer-events: none; }
  .quote-label { font-size: 10px; font-weight: 700; letter-spacing: 1.5px; text-transform: uppercase; color: var(--c-quote); margin-bottom: 12px; display: flex; align-items: center; gap: 6px; }
  .quote-label::before { content: 'âœ¦'; font-size: 8px; }
  .quote-text { font-size: 15px; font-weight: 600; line-height: 1.7; margin-bottom: 12px; }
  .quote-by { font-size: 12px; color: var(--tx-d); font-weight: 500; }
  
  /* ëª¨ë°”ì¼ ê¸€ì“°ê¸° 2ì—´ ê·¸ë¦¬ë“œ */
  .writing-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  .writing-item { background: var(--bg-card); border-radius: 14px; padding: 16px 14px; box-shadow: 0 1px 4px rgba(0,0,0,.03); position: relative; overflow: hidden; border: 1px solid transparent; flex-direction:column; align-items:flex-start; }
  .writing-item.on { border-color: var(--border-l); box-shadow: 0 4px 12px rgba(0,0,0,0.06); background: var(--bg-card); }
  .writing-item::before { content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%; border-radius: 4px 0 0 4px; display:block; }
  .writing-item[data-tab="navi"]::before { background: var(--c-navi); }
  .writing-item[data-tab="fiction"]::before { background: var(--c-500); }
  .writing-item[data-tab="blog"]::before { background: var(--c-blog); }
  .writing-item[data-tab="book"]::before { background: var(--c-book); }
  .writing-item[data-tab="quote"]::before { background: var(--c-quote); }
  .writing-item[data-tab="memo"]::before { background: var(--c-memo); }
  .wi-name { font-size: 15px; font-weight: 700; color: var(--tx); margin-bottom: 6px; letter-spacing: -0.2px; }
  .writing-item.on .wi-name { color: var(--tx); }
  .wi-count { font-size: 22px; font-weight: 800; color: var(--tx-hint); font-family: 'JetBrains Mono', monospace; background:transparent; padding:0; border:none; }
  .writing-item.on .wi-count { background:transparent; color: var(--tx-hint); border:none; }
  .wi-arrow { display: block; position: absolute; right: 14px; top: 50%; transform: translateY(-50%); font-size: 16px; font-weight: 600; color: var(--tx-hint); opacity: 0.5; }
  
  /* ëª¨ë°”ì¼ ë°ì¼ë¦¬ ë£¨í‹´ ë””ìì¸ (ì´ë¯¸ì§€ ì™„ë²½ ë§¤ì¹­) */
  .chk-week-hdr { border-bottom: none; display:none; } 
  .chk-row { padding: 0; border-bottom: none; background:var(--bg-card); border-radius:16px; margin-bottom:10px; overflow:hidden; position:relative; display:flex; align-items:center; justify-content:space-between; padding:16px 20px;}
  .chk-row.bg-exercise { background: #fdf1ef; }
  .chk-row.bg-vitamin { background: #fef6eb; }
  .chk-row.bg-english { background: #eff3f9; }
  .chk-row.bg-japanese { background: #f2f8f2; }
  .chk-row.bg-drawing { background: #f5f0f8; }
  .chk-row.bg-ukulele { background: #fbf1f5; }
  .chk-row.bg-nodrink { background: #f0f7f5; }
  .chk-left { display: flex; align-items: center; gap: 14px; z-index: 1; flex: 1; }
  .chk-box { width: 30px; height: 30px; border-radius: 10px; border: 2px solid rgba(0,0,0,0.05); background: white; box-shadow: 0 2px 6px rgba(0,0,0,0.02); }
  .chk-box.checked { border-color: transparent; }
  .chk-box.checked::after { content: ''; width: 6px; height: 13px; border: solid white; border-width: 0 2.5px 2.5px 0; transform: rotate(45deg); margin-top: -3px; }
  .chk-info { display: flex; flex-direction: column; justify-content: center; gap: 2px; }
  .chk-name { font-size: 17px; font-weight: 800; color: var(--tx); letter-spacing: -0.3px; }
  .chk-streak { font-size: 14px; font-weight: 800; display: flex; align-items: center; gap: 4px; opacity: 0.9; flex-direction:row;}
  .chk-dots { display: flex; gap: 6px; align-items: center; z-index: 1; }
  .chk-dot { width: 20px; height: 20px; border-radius: 6px; background: rgba(255,255,255,0.7); border: 1px solid rgba(0,0,0,0.03); cursor:pointer; }
  .chk-dot.done { border-color: transparent; }
  .chk-dot.today { box-shadow: inset 0 0 0 2px rgba(0,0,0,0.1); }
  
  /* ëª¨ë°”ì¼ í†µê³„ */
  .st-card { border-radius: 16px; padding: 22px; box-shadow: 0 1px 6px rgba(0,0,0,.03); margin-bottom: 14px; }
  .st-lb { font-size: 15px; font-weight: 800; }
  .st-sub span { font-size: 12px; gap: 6px; }
  .st-sub b { font-size: 16px; font-weight: 800; }
  .st-bar { height: 6px; border-radius: 3px; margin-top: 20px; }
  .book-mini { padding: 12px 0; font-size: 14px; }
  .book-mini-p { font-size: 13px; font-weight: 600; }

  /* --- 2ë‹¨ ë¦¬ìŠ¤íŠ¸ (ë°ì´ì› ëª¨ë°”ì¼ ì™„ë²½ ë§¤ì¹­) --- */
  .lp-head { background: var(--bg); padding-top: 10px; height: 64px; }
  .lp-list { padding-bottom:120px; }
  .lp-month-hdr { font-size: 14px; font-weight: 800; color: var(--tx-d); padding: 16px 20px 8px; background: var(--bg); position: sticky; top: 0; z-index: 5; text-transform: uppercase; letter-spacing: 0.5px;}
  
  /* ì—¬ë°±ê³¼ í°íŠ¸ í¬ê¸° ë°ì´ì› ìŠ¤íƒ€ì¼ ì ìš© */
  .lp-item { padding: 14px 16px; gap: 14px; align-items:flex-start;}
  .lp-item:active { background:var(--bg-card); }
  .lp-date-wrap { min-width: 28px; padding-top: 0; }
  .lp-date-dow { font-size: 11px; color: #a09a90; font-weight: 600; margin-bottom: 0; }
  .lp-date-day { font-size: 22px; font-weight: 700; color: #4a453e; line-height: 1; margin-top: 2px; }
  
  .lp-text-wrap { gap: 0; }
  .lp-item-title { font-size: 16px; font-weight: 700; color: #1a1714; margin-bottom: 2px; line-height: 1.3; }
  .lp-item-preview { font-size: 14px; color: #7a7368; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; }
  .lp-item-time { font-size: 11.5px; color: #b0a898; margin-top: 4px; font-weight: 500; }
  .quote-txt { font-size: 15px; }

  .fab-btn { display: flex; align-items: center; justify-content: center; position: fixed; bottom: 32px; right: 24px; z-index: 90;}
  
  /* --- 3ë‹¨ ì—ë””í„° (ë°ì´ì› ì˜ë¡œìš° í—¤ë” & ì œìŠ¤ì²˜) --- */
  .ed-topbar { padding: 0 16px; justify-content:space-between; background:var(--yellow); border-bottom:none; height:60px; min-height:60px;}
  .ed-header-date { font-size:16px; font-weight:800; color:white; opacity:1;}
  .ed-top-btn.pc-only { display: none; } 
  .ed-save-status { display:none; } 
  .ed-date-center { display: none; }
  
  /* ì™„ë£Œ ë²„íŠ¼ í•œì¤„ ê³ ì • */
  .ed-btn-done { display:block; color:white; font-weight:800; background:none; border:none; font-size:17px; cursor:pointer; font-family:'Pretendard',sans-serif; padding:10px 0 10px 10px; margin-left:auto; flex-shrink:0; white-space:nowrap; }
  .toolbar { display:none !important; } 
  
  /* ì—ë””í„° ë³¸ë¬¸ ê°€ë…ì„± ê°•í™” */
  .ed-title { font-size: 26px; padding-bottom: 5px; margin-bottom: 20px; }
  .ed-body { font-size: 16px; line-height: 1.6; }
  .quote-body { font-size: 20px; line-height: 1.7; }
  .editor-content-wrap { padding: 30px 24px 200px 24px; }
  
  .sf-row { flex-direction: column; gap: 12px; }
  .special-form { padding: 16px 24px; gap: 12px; }
  
  /* âœ¨ ëª¨ë°”ì¼ ë°”í…€ì‹œíŠ¸ í¸ì§‘ íˆ´ (í‚¤ë³´ë“œ ìœ„ ìƒì‹œ ë…¸ì¶œ) */
  .mob-tool-bar { display:flex; position:absolute; bottom:max(20px, env(safe-area-inset-bottom)); right:20px; z-index:80; transition: bottom 0.1s;}
  .mob-fmt-btn { width:56px; height:56px; border-radius:50%; background:var(--bg-card); border:1px solid var(--border-l); box-shadow:0 4px 16px rgba(0,0,0,0.1); display:flex; align-items:center; justify-content:center; font-family:'Noto Serif KR', serif; font-size:24px; font-weight:700; color:var(--tx); cursor:pointer; transition:0.1s;}
  .mob-fmt-btn:active { background:var(--bg); transform:scale(0.95); }

  .fs-overlay { display:block; position:fixed; inset:0; background:rgba(0,0,0,0.4); z-index:100; opacity:0; pointer-events:none; transition:opacity 0.2s; }
  .fs-overlay.on { opacity:1; pointer-events:auto; }
  .fs-sheet { display:flex; position:fixed; bottom:0; left:0; right:0; background:var(--bg-card); border-radius:24px 24px 0 0; padding:24px 20px max(24px, env(safe-area-inset-bottom)); z-index:101; transform:translateY(100%); transition:transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1); box-shadow:0 -4px 24px rgba(0,0,0,0.15); flex-direction:column; }
  .fs-sheet.on { transform:translateY(0); }
  .fs-btn { display:flex; align-items:center; width:100%; padding:18px 8px; font-size:18px; font-weight:600; font-family:'Pretendard',sans-serif; border:none; background:none; text-align:left; color:var(--tx); border-bottom:1px solid var(--bg); }
  .fs-btn:last-child { border-bottom:none; }
  .fs-btn:active { background:var(--bg); border-radius:12px;}
  .fs-btn svg { width:26px; height:26px; margin-right:16px; stroke:var(--tx-d); stroke-width:2.5; fill:none; stroke-linecap:round; stroke-linejoin:round; }
  .fs-sub { margin-left:auto; font-size:15px; color:var(--tx-m); font-weight:600; }
  .fs-more-tools { display:none; flex-wrap:wrap; gap:10px; padding-top:20px; border-top:1px solid var(--border-l); margin-top:10px;}
}
</style>
</head>
<body>

<div id="loadingScreen">
  <div class="loading-dots">
     <span></span><span></span><span></span><span></span><span></span>
  </div>
  <img src="gio_circle_white_closeup2_512.png" alt="ì§€ì˜¤" class="loading-cat">
</div>

<div id="lockScreen" class="hidden">
  <div class="lock-card">
    <div class="lock-brand">ì´ë¦„í‘œ ë¶™ì´ê¸° ê²Œì„</div>
    <div class="lock-desc">ê°œì¸ ê¸°ë¡ ê³µê°„ì…ë‹ˆë‹¤. ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.</div>
    <div id="googleSignInBtn"></div>
    <div class="lock-err" id="lockErr"></div>
  </div>
</div>

<div class="app view-list" id="mainApp" style="display:none;">

<div class="side">
  <div class="header side-hdr">
    <div class="header-left">
      <img src="gio_circle_white_closeup2_512.png" alt="ì§€ì˜¤" class="avatar">
      <div class="brand">ì´ë¦„í‘œ ë¶™ì´ê¸° ê²Œì„</div>
    </div>
    <div class="sync-status" onclick="SYNC.syncAll()">
      <span class="sync-dot" id="syncDot"></span>
      <span id="syncStatus">ì™„ë£Œë¨</span>
    </div>
  </div>
  <div class="side-scroll">
    <div class="quote-section">
      <div class="quote-card" onclick="showRandomQuote()">
        <div class="quote-mark">"</div>
        <div class="quote-label">ì˜¤ëŠ˜ì˜ ì–´êµ¬</div>
        <div class="quote-text" id="quoteText">ì–´êµ¬ë¡ì— ë¬¸ì¥ì„ ì¶”ê°€í•´ë³´ì„¸ìš”</div>
        <div class="quote-by" id="quoteBy"></div>
      </div>
    </div>

    <div class="section" style="margin-bottom:10px;">
      <div class="section-header"><div class="section-title">ê¸€ì“°ê¸°</div></div>
      <div class="writing-grid" id="sideNav"></div>
    </div>
    
    <div class="section" style="margin-bottom:30px;">
      <div class="section-header"><div class="section-title">ë°ì¼ë¦¬ ë£¨í‹´</div></div>
      <div class="chk-table" id="chkTable"></div>
    </div>
    
    <div class="section" style="padding-bottom:40px;">
      <div class="section-header"><div class="section-title">ê¸°ë¡</div></div>
      <div class="st-card">
        <div class="st-row"><span class="st-lb">ì˜¤ëŠ˜ ì“´ ê¸€</span></div>
        <div class="st-sub"><span>ì˜¤ëŠ˜<b id="wToday">0</b></span><span>ì›”ê°„<b id="wMonth">0</b></span><span>ì—°ê°„<b id="wYear">0</b></span></div>
        <div class="st-bar"><div class="st-bar-f" id="wBar" style="width:0"></div></div>
      </div>
      <div class="st-card" id="bookWidget">
        <div class="st-row"><span class="st-lb">ì˜¤ëŠ˜ ì½ì€ ì±…</span><button class="more-btn" onclick="switchTab('book'); setMobileView('list');">ë”ë³´ê¸°</button></div>
        <div class="st-sub"><span>ì˜¤ëŠ˜<b id="bToday">0</b></span><span>ì›”ê°„<b id="bMonth">0</b></span><span>ì—°ê°„<b id="bYear">0</b></span></div>
        <div class="st-bar" style="margin-bottom:12px"><div class="st-bar-f" id="bBar" style="width:0"></div></div>
        <div id="bookMiniList" style="padding-top:12px; border-top:1px solid var(--border-l)"></div>
      </div>
    </div>
  </div>
</div>

<div class="list-panel">
  <div class="col-header lp-head">
    <button class="mobile-nav-btn" onclick="setMobileView('side')" title="ë©”ë‰´ ì—´ê¸°">
      <svg viewBox="0 0 24 24"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
    </button>
    <span id="lpHeadTitleText">ê¸€ ëª©ë¡</span>
  </div>
  <div class="lp-list" id="lpList"></div>
  
  <button class="fab-btn" onclick="handleNew()" title="ìƒˆ ê¸€ ì‘ì„±">
    <svg viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
  </button>
</div>

<div class="editor">
  <div class="col-header ed-topbar">
    <div class="ed-topbar-left">
      <button class="mobile-nav-btn mobile-back-btn" onclick="setMobileView('list')" title="ëª©ë¡ìœ¼ë¡œ ê°€ê¸°">
        <svg viewBox="0 0 24 24"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
      </button>
      <span class="ed-header-date" id="edDate"></span>
      <span class="ed-save-status" id="edSaveStatus">ì €ì¥ë¨</span>
    </div>
    <div class="ed-topbar-right">
      <button class="ed-top-btn pc-only" onclick="handleNew()">+ ìƒˆ ê¸€</button>
      <button class="ed-btn-done" onclick="handleDone()">ì™„ë£Œ</button>
    </div>
  </div>
  
  <div class="toolbar" id="edToolbar">
    <button class="tb-btn" title="êµµê²Œ" onclick="execCmd('bold')"><b>B</b></button>
    <button class="tb-btn" title="ê¸°ìš¸ì„" onclick="execCmd('italic')"><i>I</i></button>
    <button class="tb-btn" title="ì·¨ì†Œì„ " onclick="execCmd('strikeThrough')"><s>S</s></button>
    <div class="tb-sep"></div>
    <button class="tb-btn" title="ì œëª© 1" onclick="execCmd('formatBlock','h1')">H1</button>
    <button class="tb-btn" title="ì œëª© 2" onclick="execCmd('formatBlock','h2')" style="font-size:14px">H2</button>
    <button class="tb-btn" title="ì œëª© 3" onclick="execCmd('formatBlock','h3')" style="font-size:12px">H3</button>
    <div class="tb-sep"></div>
    <button class="tb-btn" title="ì¸ìš©" onclick="execCmd('formatBlock','blockquote')"><svg viewBox="0 0 24 24"><path d="M6 17h3l2-4V7H5v6h3M14 17h3l2-4V7h-6v6h3"/></svg></button>
    <button class="tb-btn" title="êµ¬ë¶„ì„ " onclick="execCmd('insertHorizontalRule')"><svg viewBox="0 0 24 24"><line x1="3" y1="12" x2="21" y2="12"/></svg></button>
    <div class="tb-sep"></div>
    <button class="tb-btn" title="ìˆœì„œ ì—†ëŠ” ëª©ë¡" onclick="execCmd('insertUnorderedList')"><svg viewBox="0 0 24 24"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg></button>
    <button class="tb-btn" title="ìˆœì„œ ìˆëŠ” ëª©ë¡" onclick="execCmd('insertOrderedList')"><svg viewBox="0 0 24 24"><line x1="10" y1="6" x2="21" y2="6"></line><line x1="10" y1="12" x2="21" y2="12"></line><line x1="10" y1="18" x2="21" y2="18"></line><text x="3" y="10" font-size="11" font-family="sans-serif" stroke="none" fill="currentColor" font-weight="bold">1</text><text x="3" y="16" font-size="11" font-family="sans-serif" stroke="none" fill="currentColor" font-weight="bold">2</text><text x="3" y="22" font-size="11" font-family="sans-serif" stroke="none" fill="currentColor" font-weight="bold">3</text></svg></button>
    <button class="tb-btn" title="ì²´í¬ë¦¬ìŠ¤íŠ¸" onclick="insertChecklist()"><svg viewBox="0 0 24 24"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg></button>
  </div>
  
  <div id="editorText" style="display:flex;flex-direction:column;flex:1;overflow:hidden">
    <div class="editor-scroll-area">
      <div class="editor-content-wrap">
        <input class="ed-title" id="edTitle" placeholder="ì œëª©">
        <div class="ed-body" id="edBody" contenteditable="true" spellcheck="false" translate="no" data-placeholder="ì—¬ê¸°ì— ê¸€ì„ ì“°ì„¸ìš”... (ì´ë¯¸ì§€ ë³µì‚¬+ë¶™ì—¬ë„£ê¸° ê°€ëŠ¥)"></div>
      </div>
    </div>
    <div class="ed-foot"><span id="edChars">0ì</span><span id="edWords">0ë‹¨ì–´</span><span id="edPages">0ë§¤</span></div>
  </div>
  
  <div id="editorBook" style="display:none;flex-direction:column;flex:1;overflow:hidden">
    <div class="editor-scroll-area">
      <div class="editor-content-wrap">
        <div class="special-form">
          <div class="sf-field"><span class="sf-label">ì œëª©</span><input class="sf-input" id="book-title" placeholder="ì±… ì œëª©"></div>
          <div class="sf-row"><div class="sf-field" style="flex:2"><span class="sf-label">ì €ì</span><input class="sf-input" id="book-author" placeholder="ì €ìëª…"></div><div class="sf-field" style="flex:2"><span class="sf-label">ì¶œíŒì‚¬</span><input class="sf-input" id="book-publisher" placeholder="ì¶œíŒì‚¬ëª…"></div><div class="sf-field" style="flex:1"><span class="sf-label">ì½ì€ ì–‘ (p)</span><input class="sf-input" id="book-pages" placeholder="ìˆ«ìë§Œ" type="number"></div></div>
        </div>
        <div class="ed-body" id="book-body" contenteditable="true" spellcheck="false" translate="no" data-placeholder="ì±…ì— ëŒ€í•œ ë©”ëª¨..."></div>
      </div>
    </div>
  </div>

  <div id="editorQuote" style="display:none;flex-direction:column;flex:1;overflow:hidden">
    <div class="editor-scroll-area">
      <div class="editor-content-wrap">
        <div class="special-form"><div class="sf-field"><span class="sf-label">ì¶œì²˜</span><input class="sf-input" id="quote-by" placeholder="ì±… ì œëª©, ì €ì ë“±"></div></div>
        <div class="ed-body" id="quote-body" contenteditable="true" spellcheck="false" translate="no" data-placeholder="ì¸ìƒ ê¹Šì€ ë¬¸ì¥ì„ ê¸°ë¡í•˜ì„¸ìš”..."></div>
      </div>
    </div>
  </div>

  <div id="editorMemo" style="display:none;flex-direction:column;flex:1;overflow:hidden">
    <div class="editor-scroll-area">
      <div class="editor-content-wrap">
        <input class="ed-title" id="memo-title" placeholder="ë©”ëª¨ ì œëª©">
        <div class="ed-body" id="memo-body" contenteditable="true" spellcheck="false" translate="no" data-placeholder="ë©”ëª¨ë¥¼ ì‘ì„±í•˜ì„¸ìš”... (ì´ë¯¸ì§€ ë³µì‚¬+ë¶™ì—¬ë„£ê¸° ê°€ëŠ¥)"></div>
      </div>
    </div>
  </div>
  
  <div class="mob-tool-bar" id="mobToolbar">
     <button class="mob-fmt-btn" onmousedown="event.preventDefault(); toggleFormatMenu()">Aa</button>
  </div>
  
  <div id="formatSheetOverlay" class="fs-overlay" onmousedown="event.preventDefault(); toggleFormatMenu()"></div>
  <div id="formatSheet" class="fs-sheet">
     <button class="fs-btn" onmousedown="event.preventDefault(); execCmd('formatBlock','p'); toggleFormatMenu()">
        <svg viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg><span>ë³¸ë¬¸</span>
     </button>
     <button class="fs-btn" onmousedown="event.preventDefault(); execCmd('formatBlock','h1'); toggleFormatMenu()">
        <svg viewBox="0 0 24 24"><polyline points="4 7 4 4 20 4 20 7"></polyline><line x1="9" y1="20" x2="15" y2="20"></line><line x1="12" y1="4" x2="12" y2="20"></line></svg><span>ì œëª©</span>
     </button>
     <button class="fs-btn" onmousedown="event.preventDefault(); execCmd('formatBlock','h2'); toggleFormatMenu()">
        <svg viewBox="0 0 24 24"><path d="M4 12h8M4 6h16M4 18h16"></path></svg><span>ë¶€ì œ</span>
     </button>
     <button class="fs-btn" onmousedown="event.preventDefault(); execCmd('insertUnorderedList'); toggleFormatMenu()">
        <svg viewBox="0 0 24 24"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg><span>ëª©ë¡</span>
     </button>
     <button class="fs-btn" onmousedown="event.preventDefault(); execCmd('indent'); toggleFormatMenu()">
        <svg viewBox="0 0 24 24"><line x1="21" y1="12" x2="11" y2="12"></line><line x1="21" y1="6" x2="11" y2="6"></line><line x1="21" y1="18" x2="11" y2="18"></line><polyline points="3 8 7 12 3 16"></polyline></svg><span>ë“¤ì—¬ì“°ê¸°</span>
     </button>
     <button class="fs-btn" onmousedown="event.preventDefault(); showMoreFormats()">
        <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="1"></circle><circle cx="19" cy="12" r="1"></circle><circle cx="5" cy="12" r="1"></circle></svg><span>ë‹¤ë¥¸ ì˜µì…˜ ë³´ê¸°</span><span class="fs-sub">ê°€ê°€</span>
     </button>
     <div id="fsMoreTools" class="fs-more-tools">
        <button class="tb-btn" onmousedown="event.preventDefault(); execCmd('bold'); toggleFormatMenu()"><b>B</b></button>
        <button class="tb-btn" onmousedown="event.preventDefault(); execCmd('italic'); toggleFormatMenu()"><i>I</i></button>
        <button class="tb-btn" onmousedown="event.preventDefault(); execCmd('strikeThrough'); toggleFormatMenu()"><s>S</s></button>
        <button class="tb-btn" onmousedown="event.preventDefault(); execCmd('formatBlock','blockquote'); toggleFormatMenu()"><svg viewBox="0 0 24 24"><path d="M6 17h3l2-4V7H5v6h3M14 17h3l2-4V7h-6v6h3"></path></svg></button>
        <button class="tb-btn" onmousedown="event.preventDefault(); insertChecklist(); toggleFormatMenu()"><svg viewBox="0 0 24 24"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg></button>
     </div>
  </div>

</div>

<script>
// â•â•â• GOOGLE AUTH â•â•â•
const GOOGLE_CLIENT_ID = "910366325974-3ollm3pose37r1fvv8ngnd0v09f2p57l.apps.googleusercontent.com"; 
const ALLOWED_EMAIL = "leftjap@gmail.com";

function handleCredentialResponse(response) {
  try {
    const jwt = response.credential;
    const payload = JSON.parse(atob(jwt.split('.')[1]));
    
    if (payload.email === ALLOWED_EMAIL) {
      localStorage.setItem('gb_auth', '1');
      localStorage.setItem('gb_id_token', jwt);
      document.getElementById('lockScreen').classList.add('hidden');
      showApp();
    } else {
      document.getElementById('lockErr').textContent = 'ì ‘ê·¼ ê¶Œí•œì´ ì—†ëŠ” ê³„ì •ì…ë‹ˆë‹¤.';
    }
  } catch (e) {
    document.getElementById('lockErr').textContent = 'ë¡œê·¸ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
  }
}

window.onload = function () {
  if (localStorage.getItem('gb_auth') === '1' && localStorage.getItem('gb_id_token')) {
    showApp();
  } else {
    document.getElementById('loadingScreen').classList.add('hidden');
    document.getElementById('lockScreen').classList.remove('hidden');
    google.accounts.id.initialize({
      client_id: GOOGLE_CLIENT_ID,
      callback: handleCredentialResponse
    });
    google.accounts.id.renderButton(
      document.getElementById("googleSignInBtn"),
      { theme: "outline", size: "large", type: "standard", shape: "pill", text: "continue_with" }
    );
  }
};

async function showApp(){
  const loading = document.getElementById('loadingScreen');
  loading.classList.remove('hidden');
  
  SYNC.setSyncStatus('ë™ê¸°í™” ì¤‘', 'syncing');
  await SYNC.loadDatabase();
  
  init();
  
  loading.style.opacity = '0';
  setTimeout(() => {
    loading.classList.add('hidden');
    document.getElementById('mainApp').style.display='flex';
    setMobileView(window.innerWidth > 768 ? 'list' : 'side');
  }, 400);
}

// â•â•â• Storage â•â•â•
const APP_TOKEN='nametag2026';
const K={docs:'gb_docs',checks:'gb_chk',books:'gb_books',quotes:'gb_quotes',memos:'gb_memos'};
const L=k=>{try{return JSON.parse(localStorage.getItem(k))||null}catch{return null}};
const S=(k,v)=>localStorage.setItem(k,JSON.stringify(v));

const getLocalYMD=d=>`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
const today=()=>getLocalYMD(new Date());

const weekdays=['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
const formatFullDate = iso => {
  if(!iso) return '';
  const d = new Date(iso);
  let h = d.getHours(), m = d.getMinutes(), ampm = h >= 12 ? 'ì˜¤í›„' : 'ì˜¤ì „';
  h = h % 12 || 12;
  return `${d.getFullYear()}ë…„ ${d.getMonth()+1}ì›” ${d.getDate()}ì¼ (${weekdays[d.getDay()]}) ${ampm} ${h}:${String(m).padStart(2,'0')}`;
};

const formatTimeOnly = iso => {
  if(!iso) return '';
  const d = new Date(iso);
  let h = d.getHours(), m = d.getMinutes(), ampm = h >= 12 ? 'ì˜¤ì „' : 'ì˜¤ì „'; // ì‹œê°„ í‘œê¸° ìˆ˜ì • (ì˜¤ì „/ì˜¤í›„ ë™ì¼í•˜ê²Œ ë‚˜ì˜¤ë˜ ë²„ê·¸ ìˆ˜ì •)
  ampm = h >= 12 ? 'ì˜¤í›„' : 'ì˜¤ì „';
  h = h % 12 || 12;
  return `${ampm} ${h}:${String(m).padStart(2,'0')}`;
}

const getMonthYearStr = iso => {
  if(!iso) return '';
  const d = new Date(iso);
  return `${d.getFullYear()}ë…„ ${d.getMonth()+1}ì›”`;
}

function getWeekDates(){
  const d=new Date(),day=d.getDay(),sun=new Date(d);
  sun.setDate(d.getDate()-day);
  return Array.from({length:7},(_,i)=>{
    const x=new Date(sun);
    x.setDate(sun.getDate()+i);
    return getLocalYMD(x);
  });
}

const stripHtml=s=>(s||'').replace(/<[^>]*>/g,'').replace(/&nbsp;/g,' ');
const formatTopDate = iso => formatFullDate(iso);

function fixDriveImageUrls(html) {
  if(!html) return '';
  return html.replace(/https:\/\/drive\.google\.com\/uc\?export=view(&amp;|&)id=([a-zA-Z0-9_-]+)/g, 'https://drive.google.com/thumbnail?id=$2&sz=w1000');
}

// â•â•â• State & Mobile View â•â•â•
let activeTab='navi';
const textTypes=['navi','fiction','blog'];
const TAB_META={navi:'ì˜¤ëŠ˜ì˜ ë„¤ë¹„',fiction:'ë‹¨í¸ ìŠµì‘',blog:'ë¸”ë¡œê·¸',book:'ì„œì¬',quote:'ì–´êµ¬',memo:'ë©”ëª¨'};
const curIds={};
let curQuoteId = null;
let curBookId=null;
let curMemoId=null;
let currentLoadedDoc = { type: null, id: null };

function setMobileView(view) {
  const app = document.getElementById('mainApp');
  app.classList.remove('view-side', 'view-list', 'view-editor');
  app.classList.add('view-' + view);
  if(view === 'list') renderListPanel();
}

// â•â•â• Checks (Routine) â•â•â•
const ROUTINE_META = [
  { id: 'exercise', name: 'ìš´ë™', color: '#e87461', bg: '#fdf1ef' },
  { id: 'vitamin', name: 'ì˜ì–‘ì œ', color: '#f0a848', bg: '#fef6eb' },
  { id: 'english', name: 'ì˜ì–´', color: '#5a8ec4', bg: '#eff3f9' },
  { id: 'japanese', name: 'ì¼ë³¸ì–´', color: '#7cb87c', bg: '#f2f8f2' },
  { id: 'drawing', name: 'ë“œë¡œì‰', color: '#9a6cb8', bg: '#f5f0f8' },
  { id: 'ukulele', name: 'ìš°ì¿¨ë ë ˆ', color: '#d4789a', bg: '#fbf1f5' },
  { id: 'nodrink', name: 'ê¸ˆì£¼', color: '#6ab0a0', bg: '#f0f7f5' }
];

function getChk(){return(L(K.checks)||{})[today()]||{}}
function saveChk(id,v){const d=L(K.checks)||{};if(!d[today()])d[today()]={};d[today()][id]=v;S(K.checks,d)}
function getAllChk(){return L(K.checks)||{}}

function getRoutineTotals() {
  const all = getAllChk();
  const totals = {};
  ROUTINE_META.forEach(c => totals[c.id] = 0);
  Object.values(all).forEach(dayData => {
    ROUTINE_META.forEach(c => { if(dayData[c.id]) totals[c.id]++; });
  });
  return totals;
}

function renderChk(){
  const chk=getChk(), all=getAllChk(), week=getWeekDates(), td=today();
  const totals = getRoutineTotals();
  const container = document.getElementById('chkTable');
  
  let h = '';
  const isMobile = window.innerWidth <= 768;
  
  if (!isMobile) {
    h += `<div class="chk-week-hdr"><div class="day-labels">${['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '].map(d=>`<div class="day-lbl">${d}</div>`).join('')}</div></div>`;
  }
  
  ROUTINE_META.forEach(r => {
    const weekHtml = week.map((dt, i) => {
      const isDone = all[dt] && all[dt][r.id];
      return `<div class="chk-dot ${isDone ? 'done' : ''} ${dt === td ? 'today' : ''}" style="${isDone && isMobile ? `background:${r.color}` : ''}" onclick="toggleDay('${r.id}', '${dt}')"></div>`;
    }).join('');
    
    const todayDone = chk[r.id];

    if (isMobile) {
      h += `
        <div class="chk-row bg-${r.id}">
          <div class="chk-left" onclick="toggleChk('${r.id}')">
            <div class="chk-box ${todayDone ? 'checked' : ''}" style="${todayDone ? `background:${r.color}` : ''}"></div>
            <div class="chk-info">
              <div class="chk-name">${r.name}</div>
              <div class="chk-streak" style="color:${r.color}">ğŸ”¥ ${totals[r.id]}</div>
            </div>
          </div>
          <div class="chk-dots">${weekHtml}</div>
        </div>
      `;
    } else {
      h += `
        <div class="chk-row">
          <div class="chk-left" onclick="toggleChk('${r.id}')">
            <div class="chk-box ${todayDone ? 'checked' : ''}"></div>
            <div class="chk-info">
              <div class="chk-name">${r.name}</div>
              <div class="chk-streak">ğŸ”¥ ${totals[r.id]}</div>
            </div>
          </div>
          <div class="chk-dots">${weekHtml}</div>
        </div>
      `;
    }
  });
  container.innerHTML = h;
}

let _chkT=null;
function toggleChk(id) { toggleDay(id, today()); }
function toggleDay(id, dateStr) {
  const d = L(K.checks) || {};
  if(!d[dateStr]) d[dateStr] = {};
  d[dateStr][id] = !d[dateStr][id];
  S(K.checks, d);
  renderChk();
  clearTimeout(_chkT); 
  _chkT=setTimeout(()=>{ SYNC.saveChecksToSheet(dateStr, d[dateStr]); SYNC.scheduleDatabaseSave(); },1200);
}

// â•â•â• Documents â•â•â•
function allDocs(){return L(K.docs)||[]}
function getDocs(type){return allDocs().filter(d=>d.type===type)}
function saveDocs(docs){S(K.docs,docs)}

function newDoc(type){
  const doc={id:Date.now().toString(), driveId: null, type,title:'',content:'',created:new Date().toISOString(),updated:new Date().toISOString(),pinned:false};
  const docs=allDocs();docs.unshift(doc);saveDocs(docs);
  return doc;
}

function loadDoc(type, id, force=false){
  const doc=allDocs().find(d=>d.id===id);if(!doc)return;
  if(!force && currentLoadedDoc.type === type && currentLoadedDoc.id === id) return;
  
  curIds[type]=id;
  currentLoadedDoc = { type, id };
  document.getElementById('edTitle').value=doc.title;
  document.getElementById('edBody').innerHTML=fixDriveImageUrls(doc.content);
  document.getElementById('edDate').textContent=formatTopDate(doc.created);
  updateWC();
}

function saveCurDoc(type){
  if(!curIds[type])return;
  const title=document.getElementById('edTitle').value.trim();
  const content=document.getElementById('edBody').innerHTML;
  const docs=allDocs();const idx=docs.findIndex(d=>d.id===curIds[type]);
  if(idx!==-1){
    docs[idx].title=title;
    docs[idx].content=content;
    docs[idx].updated=new Date().toISOString();
    saveDocs(docs);
  }
}

function delDoc(type,id,e){
  e.stopPropagation();if(!confirm('ì‚­ì œí• ê¹Œìš”?'))return;
  saveDocs(allDocs().filter(d=>d.id!==id));
  if(curIds[type]===id) { curIds[type]=null; currentLoadedDoc = { type:null, id:null }; }
  renderListPanel();
  SYNC.scheduleDatabaseSave();
  const docs=getDocs(type);
  if(docs.length) loadDoc(type,docs[0].id, true);
  else { const nd=newDoc(type); loadDoc(type,nd.id, true); }
}

function updateWC(){
  const t = document.getElementById('edBody').textContent.trim();
  const c = t.replace(/\s/g,'').length;
  const w = t.split(/\s+/).filter(x=>x).length;
  document.getElementById('edChars').textContent = c.toLocaleString()+'ì';
  document.getElementById('edWords').textContent = w.toLocaleString()+'ë‹¨ì–´';
  document.getElementById('edPages').textContent = (c/200).toFixed(1)+'ë§¤';
  updateWritingStats();
}

// â•â•â• Books â•â•â•
function getBooks(){return L(K.books)||[]}
function saveBooks(b){S(K.books,b)}
function newBook(){
  curBookId=null;
  currentLoadedDoc = { type: 'book', id: null };
  document.getElementById('book-title').value='';
  document.getElementById('book-author').value='';
  document.getElementById('book-publisher').value='';
  document.getElementById('book-pages').value='';
  document.getElementById('book-body').innerHTML='';
  document.getElementById('edDate').textContent=formatTopDate(new Date().toISOString());
}
function saveBook(){
  const title=document.getElementById('book-title').value.trim();
  if(!title)return; 
  const b={id:curBookId||Date.now().toString(), driveId: null, title,author:document.getElementById('book-author').value.trim(),publisher:document.getElementById('book-publisher').value.trim(),pages:parseInt(document.getElementById('book-pages').value)||0,memo:document.getElementById('book-body').innerHTML,date:today(),pinned:false};
  const books=getBooks();
  if(curBookId){
    const idx=books.findIndex(x=>x.id===curBookId);
    if(idx!==-1){ b.pinned = books[idx].pinned; b.driveId = books[idx].driveId; books[idx]=b; }
  } else {
    books.unshift(b);
  }
  curBookId=b.id;
  saveBooks(books);
  updateBookStats();
  SYNC.scheduleBookSave(b);
}
function loadBook(id, force=false){
  const b=getBooks().find(x=>x.id===id);if(!b)return;
  if(!force && currentLoadedDoc.type === 'book' && currentLoadedDoc.id === id) return;
  curBookId=id;
  currentLoadedDoc = { type: 'book', id };
  document.getElementById('book-title').value=b.title;
  document.getElementById('book-author').value=b.author||'';
  document.getElementById('book-publisher').value=b.publisher||'';
  document.getElementById('book-pages').value=b.pages||'';
  document.getElementById('book-body').innerHTML=b.memo||'';
  document.getElementById('edDate').textContent=formatTopDate(b.date ? new Date(b.date).toISOString() : new Date().toISOString());
}
function delBook(id,e){
  e.stopPropagation();if(!confirm('ì‚­ì œí• ê¹Œìš”?'))return;
  saveBooks(getBooks().filter(b=>b.id!==id));
  if(curBookId===id) { curBookId=null; currentLoadedDoc = { type:null, id:null }; }
  renderListPanel();
  updateBookStats();
  SYNC.scheduleDatabaseSave();
}
function updateBookStats(){
  const books=getBooks();
  const td=today(), tm=td.slice(0,7), ty=td.slice(0,4);
  let pT=0, pM=0, pY=0;
  books.forEach(b=>{
    const p=parseInt(b.pages)||0;
    const d=b.date; 
    if(!d) return;
    if(d===td) pT+=p;
    if(d.startsWith(tm)) pM+=p;
    if(d.startsWith(ty)) pY+=p;
  });
  document.getElementById('bToday').textContent=pT+'p';
  document.getElementById('bMonth').textContent=pM+'p';
  document.getElementById('bYear').textContent=pY+'p';
  document.getElementById('bBar').style.width=Math.min(100,(pT/50)*100)+'%';
  const recentBooks = [...books].sort((a,b)=>new Date(b.date||0)-new Date(a.date||0)).slice(0,5);
  document.getElementById('bookMiniList').innerHTML=recentBooks.length?recentBooks.map(b=>`<div class="book-mini"><div class="book-mini-t">${b.title}</div><div class="book-mini-p">${b.pages}p</div></div>`).join(''):'<div style="font-size:12px;color:var(--tx-m);text-align:center;padding:16px 0">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div>';
}

// â•â•â• Quotes â•â•â•
function getQuotes(){return L(K.quotes)||[]}
function saveQuotes(q){S(K.quotes,q)}
function saveQuote(){
  const text=document.getElementById('quote-body').innerText.trim();
  if(!text)return;
  const by=document.getElementById('quote-by').value.trim();
  const quotes=getQuotes();
  if(curQuoteId) {
    const idx=quotes.findIndex(q=>q.id===curQuoteId);
    if(idx!==-1){ quotes[idx].text=text; quotes[idx].by=by; }
  } else {
    const q={id:Date.now().toString(),text,by,created:new Date().toISOString(),pinned:false};
    quotes.unshift(q);
    curQuoteId=q.id;
  }
  saveQuotes(quotes);
  SYNC.scheduleQuoteSave(text, by, curQuoteId);
}
function newQuoteForm(){
  curQuoteId=null;
  currentLoadedDoc = { type: 'quote', id: null };
  document.getElementById('quote-body').innerHTML='';
  document.getElementById('quote-by').value='';
  document.getElementById('edDate').textContent=formatTopDate(new Date().toISOString());
}
function loadQuote(id, force=false){
  const q=getQuotes().find(x=>x.id===id);if(!q)return;
  if(!force && currentLoadedDoc.type === 'quote' && currentLoadedDoc.id === id) return;
  curQuoteId=id;
  currentLoadedDoc = { type: 'quote', id };
  document.getElementById('quote-body').innerText=q.text;
  document.getElementById('quote-by').value=q.by||'';
  document.getElementById('edDate').textContent=formatTopDate(q.created);
}
function delQuote(id,e){
  e.stopPropagation();if(!confirm('ì‚­ì œí• ê¹Œìš”?'))return;
  saveQuotes(getQuotes().filter(q=>q.id!==id));
  if(curQuoteId===id) { curQuoteId=null; currentLoadedDoc = { type:null, id:null }; }
  renderListPanel();
  showRandomQuote();
  SYNC.scheduleDatabaseSave();
}
function showRandomQuote(){const quotes=getQuotes();if(!quotes.length){document.getElementById('quoteText').textContent='ì–´êµ¬ë¡ì— ë¬¸ì¥ì„ ì¶”ê°€í•´ë³´ì„¸ìš”';document.getElementById('quoteBy').textContent='';return}const q=quotes[Math.floor(Math.random()*quotes.length)];document.getElementById('quoteText').textContent=q.text.length>80?q.text.slice(0,80)+'â€¦':q.text;document.getElementById('quoteBy').textContent=q.by?'â€” '+q.by:''}

// â•â•â• Memos â•â•â•
function getMemos(){return L(K.memos)||[]}
function saveMemos(m){S(K.memos,m)}
function saveMemo(){
  const title=document.getElementById('memo-title').value.trim();
  const body=document.getElementById('memo-body').innerHTML;
  if(!title&&!stripHtml(body).trim())return;
  const memos=getMemos();
  if(curMemoId){
    const idx=memos.findIndex(m=>m.id===curMemoId);
    if(idx!==-1){memos[idx].title=title;memos[idx].content=body;memos[idx].updated=new Date().toISOString()}
  }else{
    const memo={id:Date.now().toString(), driveId: null, title,content:body,created:new Date().toISOString(),updated:new Date().toISOString(),pinned:false};
    memos.unshift(memo);curMemoId=memo.id;
  }
  saveMemos(memos);
  SYNC.scheduleDocSave('memo');
}
function loadMemo(id, force=false){
  const m=getMemos().find(x=>x.id===id);if(!m)return;
  if(!force && currentLoadedDoc.type === 'memo' && currentLoadedDoc.id === id) return;
  curMemoId=id;
  currentLoadedDoc = { type: 'memo', id };
  document.getElementById('memo-title').value=m.title||'';
  document.getElementById('memo-body').innerHTML=fixDriveImageUrls(m.content);
  document.getElementById('edDate').textContent=formatTopDate(m.created);
}
function newMemoForm(){
  curMemoId=null;
  currentLoadedDoc = { type: 'memo', id: null };
  document.getElementById('memo-title').value='';
  document.getElementById('memo-body').innerHTML='';
  document.getElementById('edDate').textContent=formatTopDate(new Date().toISOString());
}
function delMemo(id,e){
  e.stopPropagation();if(!confirm('ì‚­ì œí• ê¹Œìš”?'))return;
  saveMemos(getMemos().filter(m=>m.id!==id));
  if(curMemoId===id) { curMemoId=null; currentLoadedDoc = { type:null, id:null }; }
  renderListPanel();
  SYNC.scheduleDatabaseSave();
}

// â•â•â• Stats â•â•â•
function getTabCount(t){
  if(textTypes.includes(t))return getDocs(t).length;
  if(t==='book')return (L(K.books)||[]).length;
  if(t==='quote')return (L(K.quotes)||[]).length;
  if(t==='memo')return (L(K.memos)||[]).length;
  return 0;
}

function renderWritingGrid() {
  const nav = document.getElementById('sideNav');
  if(!nav) return;
  const tabs = [
    { id: 'navi', label: 'ì˜¤ëŠ˜ì˜ ë„¤ë¹„' },
    { id: 'fiction', label: 'ë‹¨í¸ ìŠµì‘' },
    { id: 'blog', label: 'ë¸”ë¡œê·¸' },
    { id: 'book', label: 'ì„œì¬' },
    { id: 'quote', label: 'ì–´êµ¬' },
    { id: 'memo', label: 'ë©”ëª¨' }
  ];
  let html = '';
  const isMobile = window.innerWidth <= 768;
  
  tabs.forEach(t => {
    if (isMobile) {
      html += `
        <div class="writing-item ${activeTab===t.id?'on':''}" data-tab="${t.id}" onclick="switchTab('${t.id}'); setMobileView('list');">
          <div class="wi-name">${t.label}</div>
          <div class="wi-count">${getTabCount(t.id)}</div>
          <div class="wi-arrow">â€º</div>
        </div>
      `;
    } else {
      html += `
        <div class="writing-item ${activeTab===t.id?'on':''}" onclick="switchTab('${t.id}'); setMobileView('list');">
          <span class="wi-name">${t.label}</span>
          <span class="wi-count">${getTabCount(t.id)}</span>
        </div>
      `;
    }
  });
  nav.innerHTML = html;
}

window.addEventListener('resize', () => { renderWritingGrid(); renderChk(); });

function togglePin(type, id, e) {
  e.stopPropagation();
  let items = type === 'memo' ? (L(K.memos)||[]) : type === 'book' ? (L(K.books)||[]) : type === 'quote' ? (L(K.quotes)||[]) : allDocs();
  const idx = items.findIndex(x => x.id === id);
  if (idx !== -1) { items[idx].pinned = !items[idx].pinned; }
  if (type === 'memo') S(K.memos, items); else if (type === 'book') S(K.books, items); else if (type === 'quote') S(K.quotes, items); else S(K.docs, items);
  renderListPanel();
  SYNC.scheduleDatabaseSave();
}

// â•â•â• Tab Switch â•â•â•
function switchTab(t){
  if(textTypes.includes(activeTab))saveCurDoc(activeTab);
  activeTab=t;
  
  document.getElementById('editorText').style.display=textTypes.includes(t)?'flex':'none';
  document.getElementById('editorBook').style.display=t==='book'?'flex':'none';
  document.getElementById('editorQuote').style.display=t==='quote'?'flex':'none';
  document.getElementById('editorMemo').style.display=t==='memo'?'flex':'none';
  document.getElementById('edToolbar').style.display=['book','quote'].includes(t)?'none':'flex';
  
  document.getElementById('lpHeadTitleText').textContent = TAB_META[t] || 'ëª©ë¡';

  if(textTypes.includes(t)){
    const docs=getDocs(t);
    if(curIds[t]) loadDoc(t,curIds[t], true);
    else if(docs.length) loadDoc(t,docs[0].id, true);
    else {const nd=newDoc(t);loadDoc(t,nd.id, true);}
  }
  if(t==='book'){if(curBookId)loadBook(curBookId, true);else{const b=getBooks();if(b.length)loadBook(b[0].id, true);else newBook()}}
  if(t==='memo'){if(curMemoId)loadMemo(curMemoId, true);else{const m=getMemos();if(m.length)loadMemo(m[0].id, true);else newMemoForm()}}
  if(t==='quote'){newQuoteForm();}
  renderListPanel();
}

// â•â•â• List Panel â•â•â•
function renderListPanel(){
  renderWritingGrid();
  const t=activeTab, el=document.getElementById('lpList');
  const emptyState = '<div style="text-align:center;padding:80px 20px;color:var(--tx-hint);font-size:15px">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div>';

  let items = [];
  if(textTypes.includes(t)) items = getDocs(t);
  else if(t==='book') items = getBooks();
  else if(t==='quote') items = getQuotes();
  else if(t==='memo') items = getMemos();

  if(!items.length) { el.innerHTML = emptyState; return; }

  items.sort((a,b) => {
    let d1 = a.created || a.date || 0;
    let d2 = b.created || b.date || 0;
    return (b.pinned===true) - (a.pinned===true) || new Date(d2) - new Date(d1);
  });

  let currentMonthStr = '';
  let html = '';

  items.forEach(item => {
    const dt = new Date(item.created || item.date || Date.now());
    const mStr = getMonthYearStr(dt.toISOString());
    if (mStr !== currentMonthStr) {
      html += `<div class="lp-month-hdr">${mStr}</div>`;
      currentMonthStr = mStr;
    }

    const day = dt.getDate();
    const dow = weekdays[dt.getDay()];
    const time = formatTimeOnly(item.created || item.date);
    
    let isCur = false;
    let clickFn = '';
    
    if(textTypes.includes(t)) {
      isCur = curIds[t]===item.id;
      clickFn = `loadDoc('${t}','${item.id}'); setMobileView('editor');`;
      const preview = stripHtml(item.content).slice(0,80) || '';
      html += `
      <div class="lp-item ${isCur?'on':''}" onclick="${clickFn}">
        <div class="lp-date-wrap"><div class="lp-date-dow">${dow}</div><div class="lp-date-day">${day}</div></div>
        <div class="lp-text-wrap">
          <div class="lp-item-title">${item.title||'ì œëª© ì—†ìŒ'}</div>
          ${preview ? `<div class="lp-item-preview">${preview}</div>` : ''}
          <div class="lp-item-time">${time}</div>
        </div>
        <div class="lp-item-actions">
          <button class="lp-action-btn pin ${item.pinned?'on':''}" onclick="togglePin('${t}','${item.id}',event)"><svg viewBox="0 0 24 24"><line x1="12" y1="17" x2="12" y2="22"></line><path d="M5 17h14v-1.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.68V6a3 3 0 0 0-3-3 3 3 0 0 0-3 3v4.68a2 2 0 0 1-1.11 1.87l-1.78.9A2 2 0 0 0 5 15.24Z"></path></svg></button>
          <button class="lp-action-btn del" onclick="delDoc('${t}','${item.id}',event)"><svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
        </div>
      </div>`;
    } else if(t==='book') {
      isCur = curBookId===item.id;
      clickFn = `loadBook('${item.id}'); setMobileView('editor');`;
      html += `
      <div class="lp-item ${isCur?'on':''}" onclick="${clickFn}">
        <div class="lp-date-wrap"><div class="lp-date-dow">${dow}</div><div class="lp-date-day">${day}</div></div>
        <div class="lp-text-wrap">
          <div class="lp-item-title">${item.title}</div>
          <div class="lp-item-preview">${item.author||''} ${item.publisher?' Â· '+item.publisher:''}</div>
        </div>
        <div class="lp-item-actions">
          <button class="lp-action-btn pin ${item.pinned?'on':''}" onclick="togglePin('${t}','${item.id}',event)"><svg viewBox="0 0 24 24"><line x1="12" y1="17" x2="12" y2="22"></line><path d="M5 17h14v-1.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.68V6a3 3 0 0 0-3-3 3 3 0 0 0-3 3v4.68a2 2 0 0 1-1.11 1.87l-1.78.9A2 2 0 0 0 5 15.24Z"></path></svg></button>
          <button class="lp-action-btn del" onclick="delBook('${item.id}',event)"><svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
        </div>
      </div>`;
    } else if(t==='quote') {
      isCur = curQuoteId===item.id;
      clickFn = `loadQuote('${item.id}'); setMobileView('editor');`;
      html += `
      <div class="lp-item ${isCur?'on':''}" onclick="${clickFn}">
        <div class="lp-date-wrap"><div class="lp-date-dow">${dow}</div><div class="lp-date-day">${day}</div></div>
        <div class="lp-text-wrap">
          <div class="quote-txt">${item.text}</div>
          ${item.by ? `<div class="lp-item-time" style="margin-top:4px;">${item.by}</div>` : ''}
        </div>
        <div class="lp-item-actions">
          <button class="lp-action-btn pin ${item.pinned?'on':''}" onclick="togglePin('${t}','${item.id}',event)"><svg viewBox="0 0 24 24"><line x1="12" y1="17" x2="12" y2="22"></line><path d="M5 17h14v-1.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.68V6a3 3 0 0 0-3-3 3 3 0 0 0-3 3v4.68a2 2 0 0 1-1.11 1.87l-1.78.9A2 2 0 0 0 5 15.24Z"></path></svg></button>
          <button class="lp-action-btn del" onclick="delQuote('${item.id}',event)"><svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
        </div>
      </div>`;
    } else if(t==='memo') {
      isCur = curMemoId===item.id;
      clickFn = `loadMemo('${item.id}'); setMobileView('editor');`;
      const preview = stripHtml(item.content).slice(0,80) || '';
      html += `
      <div class="lp-item ${isCur?'on':''}" onclick="${clickFn}">
        <div class="lp-date-wrap"><div class="lp-date-dow">${dow}</div><div class="lp-date-day">${day}</div></div>
        <div class="lp-text-wrap">
          <div class="lp-item-title">${item.title||'ì œëª© ì—†ìŒ'}</div>
          ${preview ? `<div class="lp-item-preview">${preview}</div>` : ''}
          <div class="lp-item-time">${time}</div>
        </div>
        <div class="lp-item-actions">
          <button class="lp-action-btn pin ${item.pinned?'on':''}" onclick="togglePin('${t}','${item.id}',event)"><svg viewBox="0 0 24 24"><line x1="12" y1="17" x2="12" y2="22"></line><path d="M5 17h14v-1.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.68V6a3 3 0 0 0-3-3 3 3 0 0 0-3 3v4.68a2 2 0 0 1-1.11 1.87l-1.78.9A2 2 0 0 0 5 15.24Z"></path></svg></button>
          <button class="lp-action-btn del" onclick="delMemo('${item.id}',event)"><svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
        </div>
      </div>`;
    }
  });

  el.innerHTML = html;
}

// â•â•â• Toolbar & Edit Utils â•â•â•
function execCmd(cmd,val){
  const target=activeTab==='memo'?document.getElementById('memo-body'):document.getElementById('edBody');
  target.focus();
  if(cmd==='formatBlock'&&val)document.execCommand(cmd,false,'<'+val+'>');
  else document.execCommand(cmd,false,val||null);
}
function insertChecklist(){
  const target=activeTab==='memo'?document.getElementById('memo-body'):document.getElementById('edBody');
  target.focus();
  document.execCommand('insertHTML', false, '<ul style="list-style:none;padding-left:0;"><li><input type="checkbox" style="margin-right:8px;transform:scale(1.2);"> </li></ul>');
}

// ëª¨ë°”ì¼ ë°”í…€ì‹œíŠ¸
let isFormatMenuOpen = false;
function toggleFormatMenu() {
  const overlay = document.getElementById('formatSheetOverlay');
  const sheet = document.getElementById('formatSheet');
  isFormatMenuOpen = !isFormatMenuOpen;
  if(isFormatMenuOpen) {
    overlay.classList.add('on');
    sheet.classList.add('on');
    document.getElementById('fsMoreTools').style.display = 'none'; 
  } else {
    overlay.classList.remove('on');
    sheet.classList.remove('on');
  }
}
function showMoreFormats() {
  const tools = document.getElementById('fsMoreTools');
  tools.style.display = tools.style.display === 'flex' ? 'none' : 'flex';
}

function setupEnterKey() {
  document.querySelectorAll('.ed-title, .sf-input').forEach(input => {
    input.addEventListener('keydown', e => {
      if(e.key === 'Enter') {
        e.preventDefault();
        const nextTarget = e.target.closest('.editor-content-wrap').querySelector('.ed-body');
        if(nextTarget) nextTarget.focus();
      }
    });
  });
}

// â•â•â• Image Paste Handler â•â•â•
async function handlePaste(e) {
  const items = (e.clipboardData || e.originalEvent.clipboardData).items;
  let hasImage = false;
  
  for (let item of items) {
    if (item.type.indexOf('image/') === 0) {
      hasImage = true;
      e.preventDefault();
      const file = item.getAsFile();
      const tempBlobUrl = URL.createObjectURL(file);
      const mimeType = file.type;
      const filename = 'img_' + Date.now() + (mimeType === 'image/png' ? '.png' : '.jpg');
      const tempId = 'img_' + Date.now();
      
      const imgHtml = `<img src="${tempBlobUrl}" id="${tempId}" alt="ì²¨ë¶€ì´ë¯¸ì§€" style="box-sizing: border-box; border: 3px solid var(--ac-light); transition: border-color 0.3s; opacity: 1;">`;
      document.execCommand('insertHTML', false, imgHtml + '<br>');
      updateWC();
      
      if(textTypes.includes(activeTab)) saveCurDoc(activeTab); else saveMemo();
      
      const reader = new FileReader();
      reader.onload = async function(ev) {
        const base64Data = ev.target.result.split(',')[1];
        try {
          const res = await SYNC.uploadImage(base64Data, filename, mimeType);
          const directUrl = `https://drive.google.com/thumbnail?id=${res.id}&sz=w1000`;
          const editor = activeTab === 'memo' ? document.getElementById('memo-body') : document.getElementById('edBody');
          const imgEl = editor.querySelector(`#${tempId}`);
          if (imgEl) { imgEl.src = directUrl; imgEl.style.border = '1px solid var(--border-l)'; imgEl.removeAttribute('id'); }
          if(textTypes.includes(activeTab)) saveCurDoc(activeTab); else saveMemo();
        } catch(err) {
          console.error('Image upload failed:', err);
          const editor = activeTab === 'memo' ? document.getElementById('memo-body') : document.getElementById('edBody');
          const imgEl = editor.querySelector(`#${tempId}`);
          if (imgEl) { imgEl.style.border = '3px solid var(--red)'; imgEl.title = 'ì—…ë¡œë“œ ì‹¤íŒ¨'; imgEl.removeAttribute('id'); }
          if(textTypes.includes(activeTab)) saveCurDoc(activeTab); else saveMemo();
        }
      };
      reader.readAsDataURL(file);
      break; 
    }
  }
  if(!hasImage) {
    setTimeout(() => { if(textTypes.includes(activeTab)) saveCurDoc(activeTab); else saveMemo(); updateWC(); }, 100);
  }
}

function setupEditorImageSelection() {
  const onImageClick = function(e) {
    if (e.target.tagName === 'IMG') {
      const range = document.createRange();
      range.selectNode(e.target);
      const sel = window.getSelection();
      sel.removeAllRanges();
      sel.addRange(range);
    }
  };
  document.getElementById('edBody').addEventListener('click', onImageClick);
  document.getElementById('memo-body').addEventListener('click', onImageClick);
}

// â•â•â• Actions â•â•â•
function handleNew(){
  const t=activeTab;
  if(textTypes.includes(t)){const nd=newDoc(t);loadDoc(t,nd.id,true)}
  else if(t==='book')newBook();
  else if(t==='quote')newQuoteForm();
  else if(t==='memo')newMemoForm();
  renderListPanel();
  setMobileView('editor');
}

function handleDone() {
  if(document.activeElement) document.activeElement.blur();
  setMobileView('list');
}

// â•â•â• Mobile Gestures & UI â•â•â•
function setupGesturesAndUI() {
  const app = document.getElementById('mainApp');
  
  // âœ¨ í‚¤ë³´ë“œ ë“±ì¥ ì‹œ í¸ì§‘ íˆ´ë°”(Aa)ë¥¼ VisualViewportë¥¼ ì´ìš©í•´ í‚¤ë³´ë“œ ìœ„ë¡œ ì˜¬ë¦¼
  const mobToolbar = document.getElementById('mobToolbar');
  const editableIds = ['edBody', 'memo-body', 'quote-body', 'book-body'];

  const adjustToolbar = () => {
    if (window.innerWidth > 768) return;
    const isFocused = document.activeElement && editableIds.includes(document.activeElement.id);
    if (isFocused) {
      mobToolbar.style.display = 'flex';
      if (window.visualViewport) {
        // í™”ë©´ ë†’ì´ì—ì„œ ë·°í¬íŠ¸ ë†’ì´ë¥¼ ë¹¼ì„œ í‚¤ë³´ë“œ ë†’ì´ ê³„ì‚°
        const offset = window.innerHeight - window.visualViewport.height;
        // í‚¤ë³´ë“œê°€ ì˜¬ë¼ì™”ìœ¼ë©´(ë³´í†µ 100px ì´ìƒ ì°¨ì´) ê·¸ë§Œí¼ ë²„íŠ¼ì„ ì˜¬ë ¤ì¤Œ
        if (offset > 50) {
            mobToolbar.style.bottom = (offset + 16) + 'px';
        } else {
            mobToolbar.style.bottom = 'max(20px, env(safe-area-inset-bottom))';
        }
      }
    } else {
      mobToolbar.style.display = 'none';
      mobToolbar.style.bottom = 'max(20px, env(safe-area-inset-bottom))';
    }
  };

  editableIds.forEach(id => {
    const el = document.getElementById(id);
    if (el) {
      el.addEventListener('focus', () => setTimeout(adjustToolbar, 100));
      el.addEventListener('blur', () => setTimeout(adjustToolbar, 100));
    }
  });

  if (window.visualViewport) {
    window.visualViewport.addEventListener('resize', adjustToolbar);
    window.visualViewport.addEventListener('scroll', adjustToolbar);
  }

  // âœ¨ ë‹¹ê²¨ì„œ ë‹«ê¸° & ìŠ¤ì™€ì´í”„ ì œìŠ¤ì²˜
  let startX = 0, startY = 0;
  let isPulling = false;
  const editorEl = document.querySelector('.editor');
  const listPanelEl = document.querySelector('.list-panel');

  app.addEventListener('touchstart', e => {
    if(window.innerWidth > 768) return;
    startX = e.touches[0].screenX;
    startY = e.touches[0].screenY;
    
    const scrollArea = e.target.closest('.editor-scroll-area');
    if (app.classList.contains('view-editor') && scrollArea && scrollArea.scrollTop <= 0) {
      isPulling = true;
      listPanelEl.style.transform = 'translateX(0)';
      listPanelEl.style.opacity = '1';
    }
  }, { passive: true });

  app.addEventListener('touchmove', e => {
    if(window.innerWidth > 768) return;
    if (isPulling && app.classList.contains('view-editor')) {
      let dy = e.touches[0].screenY - startY;
      let dx = Math.abs(e.touches[0].screenX - startX);
      
      // ì„¸ë¡œë¡œ ë‹¹ê¸¸ ë•Œë§Œ ì‘ë™
      if (dy > 0 && dy > dx) {
        e.preventDefault(); 
        let progress = dy / (window.innerHeight * 0.4);
        if(progress > 1) progress = 1;
        
        editorEl.style.transform = `translateY(${dy * 0.8}px)`; 
        editorEl.style.transition = 'none';
        
        listPanelEl.style.transform = `translateX(${-30 * (1 - progress)}%)`;
        listPanelEl.style.opacity = `${0.3 + (0.7 * progress)}`;
      }
    }
  }, { passive: false });

  app.addEventListener('touchend', e => {
    if(window.innerWidth > 768) return;
    const dx = e.changedTouches[0].screenX - startX;
    const dy = e.changedTouches[0].screenY - startY;
    
    // ì™¼ìª½ì—ì„œ ì˜¤ë¥¸ìª½ ìŠ¤ì™€ì´í”„ (ë’¤ë¡œê°€ê¸°)
    if (Math.abs(dx) > Math.abs(dy) * 1.5 && dx > 50 && startX < 40) {
      if (app.classList.contains('view-editor')) handleDone();
      else if (app.classList.contains('view-list')) setMobileView('side');
    }
    
    // ë‹¹ê²¨ì„œ ë‹«ê¸° ì¢…ë£Œ íŒì •
    if (isPulling) {
      isPulling = false;
      editorEl.style.transition = 'transform 0.35s cubic-bezier(0.2, 0.8, 0.2, 1)';
      listPanelEl.style.transition = 'transform 0.35s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.35s';
      
      if (dy > window.innerHeight * 0.35 || dy > 200) {
        handleDone(); 
      } else {
        editorEl.style.transform = `translateX(0) translateY(0)`;
      }
      
      setTimeout(() => {
        editorEl.style.transform = '';
        listPanelEl.style.transform = '';
        listPanelEl.style.opacity = '';
        listPanelEl.style.transition = '';
      }, 350);
    }
  }, { passive: true });
}

// â•â•â• GAS Sync â•â•â•
const GAS_URL='https://script.google.com/macros/s/AKfycbw3WUMJJyab2uZ33OtZVU1Rv4kvo47cqTaRecEZta4gAtaizN667CV4oZLS8q4nNUTY/exec';
const SYNC = {
  dbTimer: null, timer: null, checksTimer: null, isDbLoaded: false,

  setSyncStatus(text, type) { 
    const el = document.getElementById('syncStatus'); 
    const dot = document.getElementById('syncDot'); 
    if(el) { el.textContent = text; } 
    if(dot) { 
        dot.style.background = type === 'error' ? 'var(--red)' : type === 'syncing' ? 'var(--yellow)' : 'var(--c-navi)'; 
        dot.style.animation = type === 'syncing' ? 'pulse 1s infinite' : 'none'; 
    } 
  },
  
  async _post(data) {
    data.token = APP_TOKEN;
    data.idToken = localStorage.getItem('gb_id_token');
    try {
      const res = await fetch(GAS_URL, { method: 'POST', headers: { 'Content-Type': 'text/plain;charset=utf-8' }, body: JSON.stringify(data) });
      const json = await res.json();
      if (json.status === 'error') {
        if (json.message === 'Unauthorized') {
          alert('êµ¬ê¸€ ë¡œê·¸ì¸ ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\nìƒˆë¡œê³ ì¹¨í•˜ì—¬ ë‹¤ì‹œ ë¡œê·¸ì¸í•©ë‹ˆë‹¤.');
          localStorage.removeItem('gb_auth'); localStorage.removeItem('gb_id_token'); location.reload(); throw new Error('Unauthorized');
        } else { throw new Error(json.message); }
      }
      return json;
    } catch(e) {
      if(e.message !== 'Unauthorized') this.setSyncStatus('í†µì‹  ì§€ì—°', 'error');
      throw e;
    }
  },

  async loadDatabase() {
    try {
      const res = await this._post({ action: 'load_db' });
      // âœ¨ ë°ì´í„° ìœ ì‹¤ ë°©ì§€: ë¹ˆ ë°ì´í„°ë¡œ ë®ì–´ì“°ëŠ” ì‚¬ê³ ë¥¼ ë§‰ëŠ” ê²€ì¦ ë¡œì§
      if (res && res.dbData && Object.keys(res.dbData).length > 0) {
        const db = res.dbData;
        if (db[K.docs] && db[K.docs].length >= 0) S(K.docs, db[K.docs]);
        if (db[K.books]) S(K.books, db[K.books]); // ë³µêµ¬ ì™„ë£Œ!
        if (db[K.quotes]) S(K.quotes, db[K.quotes]); // ë³µêµ¬ ì™„ë£Œ!
        if (db[K.memos]) S(K.memos, db[K.memos]); // ë³µêµ¬ ì™„ë£Œ!
        if (db[K.checks]) S(K.checks, db[K.checks]);
        this.isDbLoaded = true;
        this.setSyncStatus('ë™ê¸°í™” ì™„ë£Œ', 'ok');
      } else {
        // ë“œë¼ì´ë¸Œì— ë°ì´í„°ê°€ ì•„ì˜ˆ ì—†ëŠ” ì´ˆê¸° ìƒíƒœì¸ ê²½ìš° í—ˆìš©
        this.isDbLoaded = true; 
        this.setSyncStatus('ì‹ ê·œ ìƒíƒœ', 'ok');
      }
    } catch(e) { this.setSyncStatus('ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨', 'error'); }
  },

  async saveDatabase() {
    if (!this.isDbLoaded) return; // DBë¥¼ ë¶ˆëŸ¬ì˜¤ê¸° ì „ì—ëŠ” ë®ì–´ì“°ê¸° ê¸ˆì§€
    const dbData = { [K.docs]: L(K.docs) || [], [K.books]: L(K.books) || [], [K.memos]: L(K.memos) || [], [K.quotes]: L(K.quotes) || [], [K.checks]: L(K.checks) || {} };
    try { await this._post({ action: 'save_db', dbData: dbData }); } catch(e) { console.error('DB ì €ì¥ ì‹¤íŒ¨', e); }
  },

  scheduleDatabaseSave() { clearTimeout(this.dbTimer); this.dbTimer = setTimeout(() => this.saveDatabase(), 3000); },

  async uploadImage(base64, filename, mimeType) {
    if(!GAS_URL) throw new Error("No GAS URL");
    this.setSyncStatus('ì—…ë¡œë“œ ì¤‘', 'syncing');
    try {
      const res = await this._post({ action: 'upload_image', bytes: base64, filename: filename, mimeType: mimeType });
      this.setSyncStatus('ì €ì¥ ì™„ë£Œ', 'ok'); return res;
    } catch(e) { this.setSyncStatus('ì—…ë¡œë“œ ì‹¤íŒ¨', 'error'); throw e; }
  },

  async saveDocToGDrive(id, type) {
    if (!GAS_URL || !this.isDbLoaded) return;
    if (this.savingDocs[id]) { this.dirtyDocs[id] = type; return; }
    this.savingDocs[id] = true;

    const items = (type === 'memo') ? getMemos() : allDocs();
    const doc = items.find(d => d.id === id);
    if (!doc || !stripHtml(doc.content).trim()) { this.savingDocs[id] = false; return; }

    this.setSyncStatus('ë™ê¸°í™” ì¤‘', 'syncing');
    try {
      const res = await this._post({ action: 'save_doc', id: doc.id, driveId: doc.driveId || null, type: type, title: doc.title || today(), content: stripHtml(doc.content) });
      if (res && res.driveId) {
        const freshItems = (type === 'memo') ? getMemos() : allDocs();
        const freshDoc = freshItems.find(d => d.id === doc.id);
        if (freshDoc && freshDoc.driveId !== res.driveId) {
          freshDoc.driveId = res.driveId;
          if (type === 'memo') saveMemos(freshItems); else saveDocs(freshItems);
        }
      }
      this.setSyncStatus('ì €ì¥ ì™„ë£Œ', 'ok'); setTimeout(() => this.setSyncStatus('ì™„ë£Œë¨', 'ok'), 2000);
    } catch(e) { this.setSyncStatus('ì €ì¥ ì‹¤íŒ¨', 'error');
    } finally { this.savingDocs[id] = false; if (this.dirtyDocs[id]) { const nextType = this.dirtyDocs[id]; delete this.dirtyDocs[id]; this.saveDocToGDrive(id, nextType); } }
  },

  scheduleChecksSave(){ clearTimeout(this.checksTimer); this.checksTimer=setTimeout(()=>{ this.saveChecksToSheet(); this.scheduleDatabaseSave(); },400) },
  async saveChecksToSheet(dateStr, checkData){if(!GAS_URL || !this.isDbLoaded)return;const dStr=dateStr||today();const dData=checkData||getChk();const p={action:'save_routine',date:dStr,checks:dData};const pk=JSON.stringify(p);if(this.checksSaving){this.checksPending=true;return}if(pk===this.lastChecksPayload)return;this.checksSaving=true;try{await this._post(p);this.lastChecksPayload=pk}catch(e){console.error(e)}finally{this.checksSaving=false;if(this.checksPending){this.checksPending=false;this.scheduleChecksSave()}}},
  
  scheduleBookSave(book) { clearTimeout(this.bookTimer); this.bookTimer = setTimeout(() => { this.saveBooksToSheet(book); this.scheduleDatabaseSave(); }, 5000); },
  scheduleQuoteSave(text, by, id) { clearTimeout(this.quoteTimer); this.quoteTimer = setTimeout(() => { if (!this.quoteSyncHistory[id]) { this.saveQuotesToSheet(text, by); this.quoteSyncHistory[id] = true; } this.scheduleDatabaseSave(); }, 5000); },
  async saveQuotesToSheet(text,by){if(!GAS_URL || !this.isDbLoaded)return;try{await this._post({action:'save_quote',text:text||'',by:by||''})}catch(e){console.error(e)}},
  
  async saveBooksToSheet(book) {
    if(!GAS_URL || !book || !this.isDbLoaded) return;
    try {
      const res = await this._post({ action:'save_doc', id: book.id, driveId: book.driveId, type:'book', title:book.title, content:'ì €ì: '+(book.author||'')+'\nì¶œíŒì‚¬: '+(book.publisher||'')+'\nì½ì€ ì–‘: '+(book.pages||0)+'p\n\n'+stripHtml(book.memo||'') });
      if (res && res.driveId) {
        const books = getBooks(); const idx = books.findIndex(b => b.id === book.id);
        if (idx !== -1 && books[idx].driveId !== res.driveId) { books[idx].driveId = res.driveId; saveBooks(books); }
      }
    } catch(e) { console.error(e); }
  },

  scheduleDocSave(type){ clearTimeout(this.timer); this.timer = setTimeout(() => { let id = (type === 'memo') ? curMemoId : curIds[type]; if(id) this.saveDocToGDrive(id, type); this.scheduleDatabaseSave(); }, 5000); },

  syncAll(){ if(!this.isDbLoaded) return; clearTimeout(this.timer); this.setSyncStatus('ë™ê¸°í™” ì¤‘', 'syncing'); for(const type of textTypes){ if(curIds[type]) this.saveDocToGDrive(curIds[type], type); } if(curMemoId) this.saveDocToGDrive(curMemoId, 'memo'); this.saveDatabase(); }
};

// â•â•â• Auto-save â•â•â•
let _at = null;
function setupAutoSave(){
  const showSaving = () => document.getElementById('edSaveStatus').textContent = 'ì €ì¥ ì¤‘...';
  const showSaved = () => document.getElementById('edSaveStatus').textContent = 'ì €ì¥ë¨';

  const saveLocalOnly = () => {
    if(textTypes.includes(activeTab)){ saveCurDoc(activeTab); showSaved(); }
    else if(activeTab==='memo'){ saveMemo(); showSaved(); }
    else if(activeTab==='book'){ saveBook(); showSaved(); }
    else if(activeTab==='quote'){ saveQuote(); showSaved(); }
  };

  const doSaveAndSync = () => { saveLocalOnly(); SYNC.scheduleDatabaseSave(); if(textTypes.includes(activeTab)) SYNC.scheduleDocSave(activeTab); else if(activeTab==='memo') SYNC.scheduleDocSave('memo'); };

  const onInput = () => { showSaving(); clearTimeout(_at); _at = setTimeout(doSaveAndSync, 800); updateWC(); };

  const els = ['edBody', 'edTitle', 'memo-body', 'memo-title', 'book-title', 'book-author', 'book-publisher', 'book-pages', 'book-body', 'quote-by', 'quote-body'];
  els.forEach(id => { const el = document.getElementById(id); if(el) { el.addEventListener('input', onInput); el.addEventListener('blur', () => { setTimeout(() => { saveLocalOnly(); }, 200); }); } });

  document.addEventListener('visibilitychange', () => { if (document.visibilityState === 'hidden') { clearTimeout(_at); saveLocalOnly(); SYNC.syncAll(); } });
}

// â•â•â• Init â•â•â•
function init(){
  try{
    renderChk();updateBookStats();updateWritingStats();setupAutoSave();setupEnterKey();
    document.getElementById('edBody').addEventListener('paste', handlePaste); document.getElementById('memo-body').addEventListener('paste', handlePaste);
    setupEditorImageSelection();
    setupGesturesAndUI();
    
    const naviDocs=getDocs('navi');if(naviDocs.length)loadDoc('navi',naviDocs[0].id,true);else{const nd=newDoc('navi');loadDoc('navi',nd.id,true)}
    if(GAS_URL)SYNC.setSyncStatus('ì™„ë£Œë¨','ok');else SYNC.setSyncStatus('ë¡œì»¬ ì „ìš©','error');
    
    renderListPanel();
  }catch(e){console.error('init error:',e);alert('ì´ˆê¸°í™” ì˜¤ë¥˜: '+e.message)}
}
</script>
</body>
</html>
