<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<link rel="icon" href="data:image/x-icon;base64,AAABAAEAICAAAAEAIACoEAAAFgAAACgAAAAgAAAAQAAAAAEAIAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAABDU3//RlR//0NOdf9BT3X/PU16/zhLeP8lPG3/GTRq/xg1a/8bO3L/HD51/xk9c/8ZPXP/Gj1y/xk4bf8WNWr/GDlv/xg8c/8XO3P/M05//3eBmv+foKf/raer/6umqf+vqqv/r6qr/6+qqv+4q6j/uq2n/7Cjov+alJ//iYmc/0dbif9IWYX/Q051/0NOdP88SnP/N0l1/yI6af8YMmb/FzVq/xo6cf8ePXL/Hzxw/zRYj/81VIX/MUt7/zFLfP8fMmH/MFKG/zVaj/8nQ3r/LEd5/3iBmP+zr6//s7Cv/7Owrv+2r63/ua2r/7yupv+6raX/uKyr/7qyt/+Vi5r/SmOO/0lciP9JXIX/Tl2E/0lXfv9CVoH/KUR0/xQ0aP8ZNmn/LUZ4/0Zkk/9KbZz/WYWz/1d9qf9chLD/YIm1/0Jbjf86Voz/TXyv/2mBqP8bNGb/WGmJ/7q3s/+wsK//tLKx/7uzr/+/trD/v7Kp/7mspv+7rqr/vK+v/6qYn/9JYIz/UWaQ/1pvk/9fc5L/WGqN/1BjiP8rQm//KENz/0dmlv9Uear/Y5C7/1uEsP9chbD/XIex/1uDr/9hi7L/Unak/1J5qP9LcaH/U2qV/0x0pP+Xp7X/u7Oq/7izq//Cu6//xbyw/7+2rP+/s63/wrWr/8OyqP+0pKX/qp2j/1dvlv9ceJr/Z4Cd/2iBnP9feJT/UWmJ/zZPeP9RcqH/WoKx/1J5qP88VoT/O1WD/0trmv9Qc6L/O1KC/12Ap/9umr3/Z5G0/2WNsf9bc5v/m6m0/769sP+3rJ//t7Cj/7yyp/+/tKX/wbaq/8W5q//Pv6n/z7+q/8m4p/+5pqH/XXiZ/156mf9jf53/Y32a/2V5lf9db4v/TWuS/11/rP9dg67/YYex/1R4ov9Jbp3/T3Wi/12Brf9Oapr/a5O2/2uUt/9girD/bJa3/3OQsP+3tK3/v7Sg/7qypP/Buan/xr6v/8i+sP/LwbD/y7+s/8/Aqv/Rwq7/zr+r/8KxpP9ieZj/ZHiW/2J3lf9meZX/cH+Y/3mFmP9rf5z/X4au/2mTtf9mkrb/cZ/A/2WRtf9hjLT/WHyp/1V6p/9vnb3/a5i6/1p4n/9jiKr/b42t/6quqf/Cuqb/vben/8W9rP/Mw7L/0cq4/9LJtf/SxrP/0sWv/8u9qv/Es6b/wK2m/1tsjP9dbo3/ZnuY/21+mf9vfJX/eIWY/3CIo/9slrn/cp6+/2yavP9unb3/b5y9/26YvP9UeKj/ZJG2/22bu/9qmbz/Q12I/0xlkf9lha3/oKms/8e+qv/Cuqr/xL6s/8zDsf/Rybb/0su0/9bItf/SxrD/0MOt/8m5qv+/r6j/YnST/2R3lP9rf5j/d4ab/4CLm/+FkqD/a4Wj/26Vt/95o8H/eKfD/3OhwP91psL/bJm8/2GMtP9vnr7/a5i7/2COtP87W4z/P1iG/2eVuv+crLH/ysGs/8O+q//Iwq7/zsi0/87Gs//QxrH/1Mez/9TJtP/Ux7L/0sWv/8i7qf9nf5z/boWf/3uMnv+Ek6D/hZOf/4mWo/9zjaz/dJ29/3ulwf93psL/dabD/3ipxf9tnr3/cJ+//3akwv92o8L/Z5W5/z9gkP89VIX/ZZK6/5Cms//PyrT/zci2/9HJtf/Rybb/1Mu3/9fLtP/VyrX/1M23/9jMt//VyLL/zcCt/2+Hof91iJ3/e4ma/4GPnf+EkJn/j5mi/3uWrv9yn73/d6fB/32rxf+BsMn/gbHK/3SnxP99rMb/favH/3qpxv9olbn/QWeZ/z5bkP9Yfq3/gqC2/87Luf/Szrv/1s67/93Uv//c0b7/3NG6/9zQuP/Xz7j/2M23/9bJs//RxLH/d4ue/32Nnv+Ajp//gI6f/4SQnf+MmqP/g5mt/3WevP9/qcP/ibPK/4q2zP9/r8n/d6nF/4Gwyv9zo8L/c6HB/2GRtv9DaZ3/Sm2f/0Nlmf9sj7P/zM3B/9nSvv/a08H/29LA/9vTv//j177/5tq+/+bZvv/n2b//5NW9/9bKuP96jZ//fYye/4GPov+Aj6D/h5il/4yeqP+Bmq//eqG//4Wvxv+MtMv/iLTL/4Ctyf99rMj/g7HL/36syP9/r8n/dqLC/09yof9cg67/Smyb/05un/+8xMD/2tO+/9TPvP/b0r//4NXB/+fbwf/w4MT/7N3D/+zewv/f0rz/x8O1/3WMoP95iqD/fYug/4GQov+Jmqj/i6Cr/3uZsP97pL//g63E/4axyP+Er8j/gK7I/4Cvyv+Es8v/g7LK/36tyP9unb7/WIKt/2CGsP9hhrD/R22d/5Cjsf/a1r//09G+/9rUvv/i2cH/5NvC/+XawP/n3ML/693C/8/JtP+3tav/b4OY/3WDmP94hJr/foqe/4SSpP+HmaX/fZmz/36mwf+Aq8P/gavG/4Ktxv+EsMn/h7XN/4q3zv+Fs8v/hLPM/3ysx/9eirL/aZW6/2GLtP9WgKv/WHqj/8rLwf/a18H/3dnD/+PbxP/k3MT/59zD/+ndxP/r3cH/y8a0/3V5if94hZj/eoia/36Lnf+EkqD/iJek/5CgqP+En7T/f6TB/4Svxv+BqcT/hq/I/4m2zv+Lts3/jrjP/4670P+Luc//h7XM/3qpxf9tnL//bZq7/1+Lsf9Tfqv/rrm9/+vmy//l4Mn/6eDI/+rgxv/v4sf/5trA/+3fwf/a07v/VmZ+/3+OoP+CkaH/ipmn/42dqP+Up6z/nbCz/5KouP99oL7/gqvF/4Orxv+Jssn/irjO/4y4z/+OutD/i7jO/4q4zv+Dscz/eqnG/3inxv95psT/bJm7/2GLtP+st7v/39vD/9bVwv/e2cT/4NrD/9jTv//i2MD/5Nm+/9XNt/+NkZX/fYyc/4WUov+NnKj/lKeu/5Wor/+br7L/m7C3/4Givf9/qML/ha3E/4ixyP+Htcz/jrrQ/4azzP+GtMz/hrbN/4Kxzf99rcn/gbHL/3+tyP9zocL/bJO3/6e1uv/c2sT/19bD/+Dbxf/o38b/4NrC/+DYwf/q4sf/z8Sv/6qglP95hpf/e4WZ/36Km/+Nnaj/laat/5msrv+esLD/ka27/3+jvv+DqsL/ha/H/4i0y/+KtMv/iLHJ/4i2zv+Jus//hbfN/36uyv98q8j/favH/2iYu/9hirH/wcjF/+LfyP/d2sf/4t7H/+niyf/q4sn/6eLJ/+zjyf/b0LX/08qy/36Mnv+BjZ//hZGi/4mZpf+Wq6//nLCy/52wsv+murv/lrDB/4Wowf+GsMf/iLXM/4Wvx/+Issr/jbvR/4280v+Cscz/dKTD/3Ggwv9zoMH/Y5K2/16FrP/Dy8P/4N/J/+Xgyf/k3cn/5eDI/+3ly//u5cv/8ObL//rt0P/l3cT/g5Sg/4mZpP+PoKn/jJqk/5Cgqf+Xqa3/m6yv/6Cxsf+rvLr/oLjE/5azxP+Os8j/hK3E/4Owyf+Ets7/eanH/2COtP9Ufqz/WISw/016qP9Mdqf/cZCv/83Txv/g38j/6OHK//Hpzf/17M//+u3Q//vu0v//9dj/7uLH/3RjYv+Gk6D/ipik/5Ggqv+WqKz/l6mt/5ywsf+gsrP/o7W2/6S3tf+2xMH/vMzN/6/DzP+Vs8T/hK/H/3ekw/9mk7f/XIev/0xtnf9XdKL/RmeV/1B1o/+Vqrr/5OTN/+vmzv/38NT/+fPX//v32//89tr/+PLV//vx1f/r3sH/fXFq/4KOnP+Hk6D/kp6p/5inrv+Yq6//mq2v/6Cwsf+js7L/o7Wz/6a3tf+1wr//vMvJ/77Oz/+Nr8T/eKC//3Sgv/9xoL//bJC0/0VRgP9nia//Xoqu/3eWsf/g4cz/7+rP//Dr0P/379P/+/bZ//v12P/57dD/9uzQ//zx1P/w6M7/jJqi/5Ofpv+Ypan/na6v/6C0tP+lubj/p7q3/6a3t/+ourj/q7y7/6y9vP+wwL3/wc7H/5mzwv95pML/cqLE/3eqzP9bd6H/N0B4/3egwP9ij7X/WIGs/8bLxP/27dD/8OjP//jx1f/699n/+/bY//z52//8+97/+fbZ//r01/99h5b/hI6a/46Zov+Woqn/mqqs/5+wsP+hs7P/orS1/6a2t/+pubn/rr69/7HBv/+5x8P/k6+//36pyf9SbZP/P1Bx/05plP88VYb/UnCZ/1qDrf9Vfaj/wcfC//vw0v/17NH/+vLV//v42v/6+dv/+Pfa//rz1v//9df//fjZ/3uHlv+IlJz/l6Ok/56trv+gsK//oLOy/6K0s/+lt7X/qLm5/6u6uv+svLz/s8PA/7HCw/95nrr/c5i7/zxDYv8wNlL/VoCt/1B5qf8iIkL/NT1e/3KYuv/JzcT///PU//n12f/7/OD/+v3g//z94v///+P/8ujK/+HTt//Swqn/gpOc/4WSm/+WoKL/oa6q/6Sxr/+isbL/obOz/6S2t/+nuLn/qru6/6+/v/+0w8H/t8jH/2aFrP9dd6L/bo6w/2yYvf9dirX/ZpW8/1Jvk/9QYIH/gpq0/9HSx///+Nj//fvd///+3///+df/8+bH/72zpf9wcnz/RlBo/1Jlgv9/k5r/gY2Y/4yWnP+Zpqb/oKqt/6Gsr/+fr7D/n7C0/6e4uP+uvrv/s8G//7XDwf+4yMb/Wm2h/0Zbk/92lLX/f6TB/2qWu/91ocH/c5y9/2uJsf9keqT/0tPF//Plw//b1b3/xca1/6exrf+Om57/W2R2/zRCY/8YGDX/FidM/3WEk/9+j5n/ipmh/5imqv+fra3/o7Cw/6GvsP+frrP/qbm7/6+9u/+0wb3/xs/F/6a1u/9DXpj/U2ye/4upwf+pws3/l7HF/5ezx/9xl7n/P1aU/1xwpP+vu7n/hJmh/2yDl/9QaIX/P1d4/ztSdP9FT2z/XWFw/46Ulv9+fYH/c4GQ/3SDkv+Ek5v/kZyf/5+pqf+irK//o6uv/6mxsv+wt7b/usO6/8XMwP/j5Mz/maSx/2uBpv/Aysn/2N/Q/7/JwP+dsLf/pbnB/4ikvv9KaaL/YHuq/2Z4kf81TnX/PlV5/09lg/9neY7/eYOR/3+EjP9vbXX/WFBa/1BCTP9ygIz/doSR/4uXmf+doqD/sLCp/7Cvqv+8u6//ysu1/9navv/j4sX/4N3D/+DcxP+7w7//sr25/6i0sf+ElJ3/YXaL/0xog/9RcYz/gqCw/3iWtP9ffav/d4aX/1pofP9ma3f/aGRq/2tgYf9oWFf/ZlZT/3hpZv+Xin7/saWS/2Rqff94gYr/jZCQ/62nm//LwaT/29Oq/9/asv/X1rb/xsmx/7a+r/+brKn/fpWe/2eAkP9Ydoz/Tm6I/0xqhf9UdY//ZYyh/26Yr/9wk6f/bnZ+/3d8hv95cm//gnFl/6CThP+8s6D/2tS///Px1////+T////q////6f/8+N3/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>이름표 붙이기 게임</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;600;700&family=Pretendard:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root{--bg:#f5f2ed;--bg-side:#edeae4;--bg-card:#e4e0d8;--bg-card-h:#dbd7cf;--bg-white:#faf9f6;--border:#d5d0c7;--border-l:#c5c0b5;--tx:#2c2922;--tx-d:#6b6358;--tx-m:#9a9488;--ac:#b08968;--ac-d:#8a6a48;--ac-light:#c9a882;--grn:#b08968;--grn-light:#e0d0c0;--red:#a06060;--tab-navi:#b08968;--tab-500:#c4956c;--tab-blog:#8a7a6a;--tab-book:#9a8878;--tab-quote:#a08a6a;--tab-memo:#a09080;--r:8px;--r-sm:5px;--side-w:280px;--list-w:280px;--shadow:0 1px 3px rgba(0,0,0,.06)}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Pretendard',sans-serif;background:var(--bg);color:var(--tx);min-height:100vh;overflow:hidden}
.app{display:flex;height:100vh}
.side{width:var(--side-w);min-width:var(--side-w);background:var(--bg-side);border-right:1px solid var(--border);display:flex;flex-direction:column;overflow-y:auto}
.side-hdr{padding:18px 16px 14px;border-bottom:1px solid var(--border)}
.side-date{font-size:10px;color:var(--tx-m);letter-spacing:1px;font-family:'JetBrains Mono',monospace}
.side-brand{font-family:'Noto Serif KR',serif;font-size:16px;font-weight:700;margin-top:3px;color:var(--ac-d);display:flex;align-items:center;gap:8px}
.avatar{width:28px;height:28px;border-radius:50%;object-fit:cover;border:2px solid var(--ac-light)}
.sync-row{display:flex;align-items:center;gap:6px;margin-top:5px}
.sync-status{font-size:9px;color:var(--tx-m);font-family:'JetBrains Mono',monospace}.sync-status.ok{color:#6a9960}.sync-status.syncing{color:var(--ac)}.sync-status.error{color:var(--red)}
.sync-btn{width:20px;height:20px;border-radius:50%;border:1px solid var(--border);background:var(--bg-white);color:var(--tx-d);font-size:11px;cursor:pointer;display:flex;align-items:center;justify-content:center;padding:0}.sync-btn:hover{background:var(--bg-card)}
.sec{padding:12px 16px}.sec-border{border-bottom:1px solid var(--border)}
.sec-t{font-size:9px;font-weight:600;text-transform:uppercase;letter-spacing:1.5px;color:var(--tx-m);margin-bottom:8px}
.chk-table{display:flex;flex-direction:column}
.chk-week-hdr{display:flex;align-items:center;padding:0 0 3px;margin-bottom:3px;border-bottom:1px solid var(--border)}.chk-week-hdr .chk-lb-space{flex:1;min-width:60px}.chk-week-hdr .day-labels{display:flex;gap:1px}.chk-week-hdr .day-lbl{width:14px;text-align:center;font-size:8px;color:var(--tx-d);font-family:'JetBrains Mono',monospace}
.chk-row{display:flex;align-items:center;padding:3px 4px;cursor:pointer;user-select:none;border-radius:var(--r-sm);transition:background .15s;margin:0 -4px}.chk-row:hover{background:var(--bg-card)}
.chk-box{width:14px;height:14px;border:1.5px solid var(--border-l);border-radius:3px;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:.2s;margin-right:6px}.chk-row.on .chk-box{background:var(--grn);border-color:var(--grn)}
.chk-box svg{width:9px;height:9px;stroke:white;stroke-width:3;fill:none;opacity:0;transition:.2s}.chk-row.on .chk-box svg{opacity:1}
.chk-lb{font-size:11px;color:var(--tx);flex:1;min-width:40px}.chk-row.on .chk-lb{color:var(--tx-d);text-decoration:line-through;text-decoration-color:var(--border-l)}
.chk-dots{display:flex;gap:1px}.chk-dot{width:14px;height:14px;border-radius:2px;background:var(--bg-white);border:1px solid var(--border)}.chk-dot.done{background:var(--grn-light);border-color:var(--grn)}.chk-dot.today{box-shadow:inset 0 0 0 1.5px var(--ac-light)}
.q-card{background:var(--bg-white);border-radius:var(--r);padding:10px 12px;border-left:3px solid var(--tab-quote);cursor:pointer;transition:.2s;box-shadow:var(--shadow);display:flex;gap:10px;align-items:flex-start}.q-card:hover{background:var(--bg-card)}
.q-avatar{width:30px;height:30px;border-radius:50%;object-fit:cover;flex-shrink:0;border:1px solid var(--border)}
.q-content{flex:1;min-width:0}.q-text{font-family:'Noto Serif KR',serif;font-size:12px;line-height:1.7;color:var(--tx)}.q-by{font-size:9px;color:var(--tx-m);margin-top:4px}.q-hint{font-size:8px;color:var(--tx-m);text-align:center;margin-top:3px;opacity:.5}
.st-card{background:var(--bg-white);border-radius:var(--r);padding:10px 12px;box-shadow:var(--shadow)}.st-row{display:flex;justify-content:space-between;align-items:center}.st-lb{font-size:11px;color:var(--tx-d)}
.st-sub{display:flex;gap:10px;margin-top:6px}.st-sub span{font-size:11px;color:var(--tx-d);font-family:'JetBrains Mono',monospace}.st-sub b{color:var(--ac-d);font-size:13px;font-weight:600}
.st-bar{height:3px;background:var(--border);border-radius:2px;margin-top:6px;overflow:hidden}.st-bar-f{height:100%;background:linear-gradient(90deg,var(--ac-light),var(--ac));border-radius:2px;transition:width .5s}
.more-btn{font-size:10px;color:var(--tx-m);background:none;border:none;cursor:pointer;font-family:'Pretendard',sans-serif}.more-btn:hover{color:var(--ac)}
.book-mini{display:flex;justify-content:space-between;padding:2px 0;font-size:11px}.book-mini-t{color:var(--tx-d);flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.book-mini-p{color:var(--ac);font-family:'JetBrains Mono',monospace;font-size:10px;margin-left:6px}
.list-panel{width:var(--list-w);min-width:var(--list-w);background:var(--bg);border-right:1px solid var(--border);display:flex;flex-direction:column;overflow:hidden}
.lp-tabs{display:flex;border-bottom:1px solid var(--border);background:var(--bg-side);height:42px}
.lp-tab{flex:1;display:flex;align-items:center;justify-content:center;gap:3px;font-size:11px;font-weight:500;color:var(--tx-m);background:none;border:none;border-bottom:2px solid transparent;cursor:pointer;transition:.2s;font-family:'Pretendard',sans-serif;padding:0 2px;white-space:nowrap}.lp-tab:hover{color:var(--tx-d);background:var(--bg-card)}.lp-tab.on{color:var(--tx);border-bottom-color:var(--ac);background:var(--bg-white)}
.lp-dot{width:6px;height:6px;border-radius:50%;flex-shrink:0}
.lp-actions{display:flex;padding:6px 10px;gap:4px;border-bottom:1px solid var(--border);background:var(--bg)}
.lp-new{flex:1;padding:5px 10px;font-size:11px;font-weight:500;color:white;background:var(--ac);border:none;border-radius:var(--r-sm);cursor:pointer;font-family:'Pretendard',sans-serif;text-align:center}.lp-new:hover{opacity:.85}
.lp-save{padding:5px 10px;font-size:11px;font-weight:500;color:var(--ac-d);background:var(--bg-white);border:1px solid var(--border);border-radius:var(--r-sm);cursor:pointer;font-family:'Pretendard',sans-serif}.lp-save:hover{background:var(--bg-card)}
.lp-list{flex:1;overflow-y:auto;padding:4px 0}
.lp-item{display:flex;flex-direction:column;padding:10px 14px;cursor:pointer;border-bottom:1px solid var(--border);transition:background .15s;position:relative}.lp-item:hover{background:var(--bg-card)}.lp-item.on{background:var(--bg-white);border-left:3px solid var(--ac)}
.lp-item-title{font-size:13px;font-weight:500;color:var(--tx);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.lp-item-date{font-size:10px;color:var(--tx-m);font-family:'JetBrains Mono',monospace;margin-top:2px}.lp-item-preview{font-size:11px;color:var(--tx-d);margin-top:3px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.lp-item-del{position:absolute;top:8px;right:8px;background:none;border:none;color:var(--tx-m);cursor:pointer;font-size:12px;opacity:0;transition:.2s;padding:2px}.lp-item:hover .lp-item-del{opacity:1}.lp-item-del:hover{color:var(--red)}
.editor{flex:1;display:flex;flex-direction:column;background:var(--bg-white);overflow:hidden}
.ed-topbar{display:flex;align-items:center;padding:8px 20px;border-bottom:1px solid var(--border);background:var(--bg);gap:8px;min-height:44px}
.ed-topbar-left{display:flex;align-items:center;gap:6px;flex:1}.ed-date-display{font-size:11px;color:var(--tx-m);font-family:'JetBrains Mono',monospace}.ed-save-status{font-size:10px;color:var(--tx-m);font-family:'JetBrains Mono',monospace;margin-left:8px}
.ed-topbar-right{display:flex;gap:6px}
.ed-top-btn{padding:5px 12px;font-size:11px;font-weight:500;color:white;background:var(--ac);border:none;border-radius:var(--r-sm);cursor:pointer;font-family:'Pretendard',sans-serif}.ed-top-btn:hover{opacity:.85}.ed-top-btn.secondary{color:var(--ac-d);background:var(--bg-white);border:1px solid var(--border)}.ed-top-btn.secondary:hover{background:var(--bg-card)}
.toolbar{display:flex;align-items:center;padding:4px 20px;border-bottom:1px solid var(--border);background:var(--bg);gap:2px}
.tb-btn{width:30px;height:28px;display:flex;align-items:center;justify-content:center;background:none;border:1px solid transparent;border-radius:var(--r-sm);cursor:pointer;color:var(--tx-d);font-size:13px;font-weight:600;transition:.15s;font-family:'Pretendard',sans-serif}.tb-btn:hover{background:var(--bg-card);border-color:var(--border)}.tb-btn svg{width:15px;height:15px;stroke:currentColor;stroke-width:2;fill:none}
.tb-sep{width:1px;height:18px;background:var(--border);margin:0 4px}
.ed-title-wrap{padding:24px 48px 0}
.ed-title{width:100%;background:none;border:none;font-family:'Pretendard',sans-serif;font-size:26px;font-weight:700;color:var(--tx);outline:none;letter-spacing:-0.02em}.ed-title::placeholder{color:var(--border-l)}
.ed-body-wrap{flex:1;overflow-y:auto;padding:16px 48px 60px}
.ed-body{width:100%;min-height:100%;outline:none;font-family:'Pretendard',sans-serif;font-size:16px;line-height:2;letter-spacing:-0.008em;color:var(--tx)}.ed-body:empty::before{content:attr(data-placeholder);color:var(--border-l)}
.ed-body blockquote{border-left:3px solid var(--ac-light);padding-left:16px;margin:8px 0;color:var(--tx-d);font-style:italic}
.ed-body h1,.ed-body h2,.ed-body h3{font-family:'Noto Serif KR',serif;margin:12px 0 4px;font-weight:600}.ed-body h1{font-size:22px}.ed-body h2{font-size:19px}.ed-body h3{font-size:16px}
.ed-body hr{border:none;border-top:1px solid var(--border);margin:16px 0}
.ed-foot{padding:8px 48px;border-top:1px solid var(--border);background:var(--bg);display:flex;gap:16px;font-size:11px;font-family:'JetBrains Mono',monospace;color:var(--tx-m)}.ed-foot span{color:var(--tx-d)}
.special-form{padding:20px 48px;display:flex;flex-direction:column;gap:10px;border-bottom:1px solid var(--border);background:var(--bg)}
.sf-field{display:flex;flex-direction:column;gap:3px}.sf-row{display:flex;gap:10px}
.sf-label{font-size:9px;font-weight:600;color:var(--tx-m);letter-spacing:.5px}
.sf-input{width:100%;background:var(--bg-white);border:1px solid var(--border);border-radius:var(--r-sm);padding:7px 10px;font-size:13px;color:var(--tx);font-family:'Pretendard',sans-serif;outline:none}.sf-input::placeholder{color:var(--border-l)}.sf-input:focus{border-color:var(--ac-light);box-shadow:0 0 0 2px rgba(176,137,104,.1)}
::-webkit-scrollbar{width:5px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
@keyframes fadeIn{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}
</style>
</head>
<body>
<div class="app">
<!-- COLUMN 1: SIDEBAR -->
<div class="side">
  <div class="side-hdr">
    <div class="side-date" id="sideDate"></div>
    <div class="side-brand"><img class="avatar" src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAAAAAAD/2wBDAFA3PEY8MlBGQUZaVUBfeMiCeG5uePWvuZHI////////////////////////////////////////////////////2wBDAVVaWnh0eOuCguv/////////////////////////////////////////////////////////////////////////wAARCABPAFADASIAAhEBAxEB/8QAGQAAAwEBAQAAAAAAAAAAAAAABAUGAwIH/8QANBAAAgEDAwIEBQIEBwAAAAAAAQIDAAQRBRIhMUEGUWFxExQigaEykUJisdEVI0OSssHx/8QAGQEAAwEBAQAAAAAAAAAAAAAAAwQFAgAB/8QAHhEAAgIDAQEBAQAAAAAAAAAAAAECEQMSITEEE2H/2gAMAwEAAhEDEQA/AN7ONUJUbscHls0/trmSOMbSfvSuCNt42KAoPU0yRHA5Vf3ocZNHs0pehyXFvNxPBG3utcXWmaZcW0kjRswRS20Ybp5A5rOJWUkgA5omMnocAd67a/TCjq+CG20nTdQh3WN69s4GTHvaMj9iR+K5XR9Wt5Cnze6Md5trgD3XB/FBKn+H6jNO8ojgRjguQBj3pgNUikZZfjAo65DA5GPelJSjXUPfm74wGeK1bVI1WGN5R9JkKAOeOQp6jPvml0ep3mmMVj1HW9MUH6dzfGjA9nB/5UZpN7Y6pqnzNnKHkt3AkO07SfSrxvDljcLlV+GW5JjYr/SmMSyNOmBzSxxaTRF23i/xDtHymv6NqH8t3A1u5+4JWjU8b+JEBFz4S+bUf6mnXKzA+uBk0Zq/gMTQSG2EUshH0/ERQf8AcBmoa78O67a3L26pe2tqhDBYMSbW9CDmjqU16gKjin4U9vFGp+liPtTGMRgcvS+F1B6UZC0jDcQOfWgWEaCV2eeftRUKbj9IoVDtXc+MeQ71q9y7IQMADoB2rLmo+nii2LNWsYL2G4tJFQxvxz096nLvTTo8FtbWUkawSSCPMjHKk9/biq6S3+MnBIYeQpPc6bM8rF/hyAD6Af4faldu/wAHYHFlp0FncJb2KbFZwNqjAJ869FjcjHP4qB0oTaffQhzkBhtGc4FXMUxXqPzTvyPjEfr9QbvAHLVm6QnJYBs9eK4FwGXtilHie3vrvRJotKuUt5/5jgMMHK57H19KdSEkuknDHEWGSrYPr/emUOwjgAD3pUqvn9X5oqENjOfzU+yk0HKd7Z7DgURGAQD2NDW/KDHlWykoAD0FKydhaNQCvRjisXI3fUmfatGkI6Y9jSu5umNyUKjaAOAcEetYNRVnc5UTBhGdy8jPT71UKzEAkdu1RljGdQ1FYskqrbpCSSMDtVkkp6ZGKf8AkTpsU+p9SNC5BASZ46k0Bqt21tDFOHVFWVRIT0CnjP2o/JIIwpGOaVeILRr+wNtvCBiCCvUEdKddpcE405KyaVwenP8A1W8Rw3PFLI5JFI3yADGegomO4Y5G7j2pCLKUoja1fCA9sd6IdwyHsaXWs6rEOd2OxrVpgqDLKN3rSbDUEs4fDK+AfTrU5qUzR6geSXbCg574/pTG3nLtJEchl/SfQ0uvbR5dWgZVyg+tvQgYFcl03HjH/h22W1WQ45wASfM809Dr54PtSXT3b5cs30ktzR8TE8c/equBVBEvO7yMOExAwBWU025cECssBe3NYTTHBAyeOwpgAl0jYrlD1JBPbFZ3NwAh2SsPQUvkkfAwuDWEkkm0ndUquFrXo207Vo5oVVpNsi/qFbvDfPLlriORCeAFwVH71IZy31EYz5c0fBqc8MisJiyjsaAwtFPHHcrfrL/lhADvAHOP/a1N7AMshyTwB1JqabXbpWcp8PDdjmsrTUp4SWIieUn9WCAB5AVx5rZcaZepND8u+6OZSx2sBz3x70xjL44cVI6HYPJfjU55d0pOTjp0xVSJBg9vMiqWGT16Tc0I7cCPiEfq49cVlcTgJj+v964+KG/iyPahrqcLB8MIobOS46keVMbUgKhbP//Z" alt="지오">이름표 붙이기 게임</div>
    <div class="sync-row"><span class="sync-status" id="syncStatus">초기화 중...</span><button class="sync-btn" onclick="SYNC.syncAll()">↻</button></div>
  </div>
  <div class="sec">
    <div class="sec-t">오늘의 어구</div>
    <div class="q-card" onclick="showRandomQuote()"><img class="q-avatar" src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAAAAAAD/2wBDAFA3PEY8MlBGQUZaVUBfeMiCeG5uePWvuZHI////////////////////////////////////////////////////2wBDAVVaWnh0eOuCguv/////////////////////////////////////////////////////////////////////////wAARCABQAFADASIAAhEBAxEB/8QAGwAAAgMBAQEAAAAAAAAAAAAABAUCAwYBBwD/xAA5EAACAQMDAAYHBwIHAAAAAAABAgMABBEFEiExMUFRgZEGFCJCYXKhIzJSYnKx0RbBJDM0Q4KS8f/EABoBAAMBAQEBAAAAAAAAAAAAAAIEBQMGAQD/xAAjEQACAgICAgIDAQAAAAAAAAABAgADBBESIQVBMTITIkJR/9oADAMBAAIRAxEAPwBTY+l9tp/MdlIxxgkyD+KU6jq1vqF5NdiOWN5X3Eb1IHy4plcx6XNF/qYQ46hGMDPlQSej7zzAQur5IwCesmjWsA7ER/OPcX+sx9WX8xXBcKO/zpxeei95FErNBCg6tyuTn+KRXNobVtpZW/S2aPXWxNN6PEjRl4ul+PnUhdD4+dCQwtIRhGwT94DinKejF9LaiaBFd84aLdhlGODzxQ7A+TNlrdvqIGLoHv8AOui4X8J8Ktn0LVbO0a6ksysKgEvuB4Pbx2UHC4fr6Pgdr4zXo03xBdWT7CE+sJ3N5ipCXIztbHhUGMLRgpFMCessRj9q+jyFx1UQEy5dQuOyjgcEdJOoPCpKvX8sVQ000V05QGM57X5phpjsFLzW/SEHjGQAfjnFFdDG4bpEB3dYYkjyFMCosP1k43hD+05a6tNNC6XwSeGQbZUJILD8QPYfjQvo5Doa6lINR/xDL/kpJ9w/PvP0qV5Z2sULSdMVVFzsTgZ8azHRyNlsc0pbSUGv9lbFyxc3N+9T1hr6G4c2fsLHJGejVQFGQRwO44qrS7mJIliuIU3gYY45zXn9nrE9vCIp4zMqn2GzyvwpnD6QwmE7g6t2KASfOkjUfidDXk0Eb3qa3XYjdaNNY6em+R4yoQHsrz+PSLkSbHQRFePa5PlWw0W+iQNLdiVMrlXBBH700j1jS7246CVSZQeC8OCfkRWlfKoEFdyflCrIYcXG5jYvR+8lCxLG5b9JH70yg9CbhwDc3UUPwUFj/Fa6OJxLiKAlT7w5o31Ncj1mZI0/Mf7UNmU5+o1Pq8CtO3O55WplhOw6rAT8+fGr4Z9zbfX5ZXPZCQx8ttEW2lWETK5baO0qOaKfS9DYl06cP+IHBqsrn3OXYJ6gt0lvdwiOWK5OBn7hFIJ9PZpMQo6Y7JGFO7ywniG+xv5JF/BISCPHqNDQRLONtzczJJnlAQK0IVxBRjX2DALXR7m4cgsiEe67gE0zt/R/o/tJikmBnAYf34q2KBFZzbS2t3heEmRgw/5Y5qNtqItwRdWLxn8KjigCr8TQ2WEbB6hfQ2DRgJG5bqKgUbAZ4NrRl+iX/blAbHy5pfHf2ky9MbCUqPeJOKM9ekkQJBbdHnzPhmvSoK6gJY6WBxNPZNHcQrIJSu7uzj60RPEoiIcFh+Xk0i0kXkbBWgkRDzkjgmnXSqoI3HPcDUK5ODaE7LHt/NWGPRmLCzbtqwLjvYV89td+66D4KhqxNQLnMbRuuesDg1cbqSUcmNPktXg04Yo0BFndsfa2N+rNdFic+3FDxRllNbTXyW1xO6F+NyjOT3Uxis2hlcwlDumyhcchfn38fWsLcxazr3KeJ4q7IHInQiu30e4mw0NozL3iM4NMF0eWbbbTwSNj3WTYf+xrSRzNlULjcR2nrq9mYDDkkd1It5Bm9CVV8Ki/0ZkP6BeS8Ms16scPGEUbz4E8A1pbTSLSxjCxjOPeY5Jrt/qMVlbGSUO4zgBBliayWoa9eS3OLeWWJD1KBjHzoUF2R76mjnGwvWzNhMbeFCWI86Q3msmKQiDDAdo6vCkHrEs77pbhCSeSzV0yhW2IyS/o5pqvCRTtzuT7vLWMNVjUWwafJbxn7dlTrIFTaDPPTyYHbnro6SJ0TcCXJ+nhQrlJfZkXOO8kU2JL5EyqPUYrJ5lEbMSpCOrD2SavguwtkgaSRpVcFBnJI/8AKg6RrGXEGEXrIFdSzkdRLDExHWGC4NLvjI3cp0+SsrUKR0JorjU4ILmynklkXEW11Ck9uRn605TX7dIS8jFVGMBlO4+FYc210zbmWVj+bJ/eoO9zH1xSE9/bWIwh7MZfy5b6iaHVNQmvyTHtCAcJu+tJjA7cSROR3bzVVrLfvJiK3QDvYZp0HZI8NAS2OSwCg+dOoFQcVkS1ndizHsxdFDCowLQD4uc0RGoUglAAOwcVTcXd6oJhtYTjsyST5VRbWt9cZlunMTE8IteHv4gjWtkz/9k=" alt=""><div class="q-content"><div class="q-text" id="rqText" style="color:var(--tx-m);font-size:11px">어구록에 문장을 추가해보세요</div><div class="q-by" id="rqBy"></div></div></div>
    <div class="q-hint">클릭하면 다른 문장</div>
  </div>
  <div class="sec"><div class="sec-t">데일리 루틴</div><div class="chk-table" id="chkTable"></div></div>
  <div class="sec sec-border">
    <div class="sec-t">기록</div>
    <div class="st-card" style="margin-bottom:6px"><div class="st-row"><span class="st-lb">오늘 쓴 글</span></div><div class="st-sub"><span>오늘 <b id="wToday">0</b>매</span><span>주간 <b id="wWeek">0</b>매</span><span>누적 <b id="wTotal">0</b>매</span></div><div class="st-bar"><div class="st-bar-f" id="wBar" style="width:0"></div></div></div>
    <div class="st-card"><div class="st-row"><span class="st-lb">오늘 읽은 책</span><button class="more-btn" onclick="switchTab('book')">더보기 →</button></div><div id="bookMiniList" style="margin-top:3px"></div></div>
  </div>
</div>

<!-- COLUMN 2: LIST PANEL -->
<div class="list-panel">
  <div class="lp-tabs" id="lpTabs">
    <button class="lp-tab on" data-t="navi" onclick="switchTab('navi')"><span class="lp-dot" style="background:var(--tab-navi)"></span>네비</button>
    <button class="lp-tab" data-t="fiction" onclick="switchTab('fiction')"><span class="lp-dot" style="background:var(--tab-500)"></span>습작</button>
    <button class="lp-tab" data-t="blog" onclick="switchTab('blog')"><span class="lp-dot" style="background:var(--tab-blog)"></span>블로그</button>
    <button class="lp-tab" data-t="book" onclick="switchTab('book')"><span class="lp-dot" style="background:var(--tab-book)"></span>서재</button>
    <button class="lp-tab" data-t="quote" onclick="switchTab('quote')"><span class="lp-dot" style="background:var(--tab-quote)"></span>어구</button>
    <button class="lp-tab" data-t="memo" onclick="switchTab('memo')"><span class="lp-dot" style="background:var(--tab-memo)"></span>메모</button>
  </div>
  <div class="lp-actions"><button class="lp-new" onclick="handleNew()">+ 새 글</button><button class="lp-save" id="lpSaveBtn" onclick="handleSave()" style="display:none">저장</button></div>
  <div class="lp-list" id="lpList"></div>
</div>

<!-- COLUMN 3: EDITOR -->
<div class="editor">
  <div class="ed-topbar">
    <div class="ed-topbar-left"><span class="ed-date-display" id="edDate"></span><span class="ed-save-status" id="edSaveStatus">저장됨</span></div>
    <div class="ed-topbar-right"><button class="ed-top-btn secondary" onclick="handleSave()">저장</button><button class="ed-top-btn" onclick="handleNew()">+ 새 글</button></div>
  </div>
  <div class="toolbar" id="edToolbar">
    <button class="tb-btn" title="굵게" onclick="execCmd('bold')"><b>B</b></button>
    <button class="tb-btn" title="기울임" onclick="execCmd('italic')"><i>I</i></button>
    <button class="tb-btn" title="취소선" onclick="execCmd('strikeThrough')"><s>S</s></button>
    <div class="tb-sep"></div>
    <button class="tb-btn" title="제목 1" onclick="execCmd('formatBlock','h1')" style="font-size:14px">H1</button>
    <button class="tb-btn" title="제목 2" onclick="execCmd('formatBlock','h2')" style="font-size:12px">H2</button>
    <button class="tb-btn" title="제목 3" onclick="execCmd('formatBlock','h3')" style="font-size:11px">H3</button>
    <div class="tb-sep"></div>
    <button class="tb-btn" title="인용" onclick="execCmd('formatBlock','blockquote')"><svg viewBox="0 0 24 24"><path d="M6 17h3l2-4V7H5v6h3M14 17h3l2-4V7h-6v6h3"/></svg></button>
    <button class="tb-btn" title="구분선" onclick="execCmd('insertHorizontalRule')"><svg viewBox="0 0 24 24"><line x1="3" y1="12" x2="21" y2="12"/></svg></button>
    <div class="tb-sep"></div>
    <button class="tb-btn" title="본문으로" onclick="execCmd('formatBlock','div')" style="font-size:10px">¶</button>
  </div>
  <div id="editorText" style="display:flex;flex-direction:column;flex:1;overflow:hidden">
    <div class="ed-title-wrap"><input class="ed-title" id="edTitle" placeholder="제목"></div>
    <div class="ed-body-wrap"><div class="ed-body" id="edBody" contenteditable="true" data-placeholder="여기에 글을 쓰세요..."></div></div>
    <div class="ed-foot"><span id="edChars">0자</span><span id="edWords">0단어</span><span id="edPages">0매</span></div>
  </div>
  <div id="editorBook" style="display:none;flex-direction:column;flex:1;overflow:hidden">
    <div class="special-form">
      <div class="sf-field"><span class="sf-label">제목</span><input class="sf-input" id="book-title" placeholder="책 제목"></div>
      <div class="sf-row"><div class="sf-field" style="flex:2"><span class="sf-label">저자</span><input class="sf-input" id="book-author" placeholder="저자명"></div><div class="sf-field" style="flex:2"><span class="sf-label">출판사</span><input class="sf-input" id="book-publisher" placeholder="출판사명"></div><div class="sf-field" style="flex:1"><span class="sf-label">읽은 양</span><input class="sf-input" id="book-pages" placeholder="p" type="number"></div></div>
    </div>
    <div class="ed-body-wrap"><div class="ed-body" id="book-body" contenteditable="true" data-placeholder="책에 대한 메모..."></div></div>
  </div>
  <div id="editorQuote" style="display:none;flex-direction:column;flex:1;overflow:hidden">
    <div class="special-form"><div class="sf-field"><span class="sf-label">출처</span><input class="sf-input" id="quote-by" placeholder="책 제목, 저자 등"></div></div>
    <div class="ed-body-wrap"><div class="ed-body" id="quote-body" contenteditable="true" data-placeholder="인상 깊은 문장을 기록하세요..." style="font-family:'Noto Serif KR',serif;font-size:15px;line-height:1.9"></div></div>
  </div>
  <div id="editorMemo" style="display:none;flex-direction:column;flex:1;overflow:hidden">
    <div class="ed-title-wrap"><input class="ed-title" id="memo-title" placeholder="메모 제목"></div>
    <div class="ed-body-wrap"><div class="ed-body" id="memo-body" contenteditable="true" data-placeholder="메모를 작성하세요..."></div></div>
  </div>
</div>
</div>
<script>
// ═══ Storage ═══
const K={docs:'gb_docs',checks:'gb_chk',books:'gb_books',quotes:'gb_quotes',memos:'gb_memos'};
const L=k=>{try{return JSON.parse(localStorage.getItem(k))||null}catch{return null}};
const S=(k,v)=>localStorage.setItem(k,JSON.stringify(v));
const today=()=>{const d=new Date();return`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`};
const weekdays=['일','월','화','수','목','금','토'];
const fmtDate=iso=>{const d=new Date(iso);return`${d.getFullYear()}.${String(d.getMonth()+1).padStart(2,'0')}.${String(d.getDate()).padStart(2,'0')} (${weekdays[d.getDay()]})`};
function getWeekDates(){const d=new Date(),day=d.getDay(),sun=new Date(d);sun.setDate(d.getDate()-day);return Array.from({length:7},(_,i)=>{const x=new Date(sun);x.setDate(sun.getDate()+i);return x.toISOString().slice(0,10)})}
const isThisWeek=iso=>getWeekDates().includes(iso?.slice(0,10));
document.getElementById('sideDate').textContent=fmtDate(new Date().toISOString());

// ═══ State ═══
let activeTab='navi';
const textTypes=['navi','fiction','blog'];
const curIds={};

// ═══ Checks ═══
const CHECKS=[{id:'exercise',label:'운동'},{id:'vitamin',label:'영양제'},{id:'english',label:'영어'},{id:'japanese',label:'일본어'},{id:'drawing',label:'드로잉'},{id:'ukulele',label:'우쿨렐레'},{id:'nodrink',label:'금주'}];
function getChk(){return(L(K.checks)||{})[today()]||{}}
function saveChk(id,v){const d=L(K.checks)||{};if(!d[today()])d[today()]={};d[today()][id]=v;S(K.checks,d)}
function getAllChk(){return L(K.checks)||{}}
function renderChk(){
  const chk=getChk(),all=getAllChk(),week=getWeekDates(),td=today();
  let h='<div class="chk-week-hdr"><div class="chk-lb-space"></div><div class="day-labels">'+['일','월','화','수','목','금','토'].map(d=>'<div class="day-lbl">'+d+'</div>').join('')+'</div></div>';
  CHECKS.forEach(c=>{h+='<div class="chk-row '+(chk[c.id]?'on':'')+'" onclick="toggleChk(\''+c.id+'\')"><div class="chk-box"><svg viewBox="0 0 16 16"><polyline points="3,8 7,12 13,4"/></svg></div><span class="chk-lb">'+c.label+'</span><div class="chk-dots">'+week.map(dt=>'<div class="chk-dot '+(all[dt]&&all[dt][c.id]?'done':'')+' '+(dt===td?'today':'')+'"></div>').join('')+'</div></div>'});
  document.getElementById('chkTable').innerHTML=h;
}
let _chkT=null;
function toggleChk(id){saveChk(id,!getChk()[id]);renderChk();clearTimeout(_chkT);_chkT=setTimeout(()=>SYNC.scheduleChecksSave(),1200)}

// ═══ Documents ═══
function allDocs(){return L(K.docs)||[]}
function getDocs(type){return allDocs().filter(d=>d.type===type)}
function saveDocs(docs){S(K.docs,docs)}
function stripHtml(s){return(s||'').replace(/<[^>]*>/g,'').replace(/&nbsp;/g,' ')}

function newDoc(type){
  const doc={id:Date.now().toString(),type,title:'',content:'',created:new Date().toISOString(),updated:new Date().toISOString()};
  const docs=allDocs();docs.unshift(doc);saveDocs(docs);return doc;
}
function loadDoc(type,id){
  const doc=allDocs().find(d=>d.id===id);if(!doc)return;
  curIds[type]=id;
  document.getElementById('edTitle').value=doc.title;
  document.getElementById('edBody').innerHTML=doc.content;
  document.getElementById('edDate').textContent=fmtDate(doc.created);
  updateWC();renderListPanel();
}
function saveCurDoc(type){
  if(!curIds[type])return;const docs=allDocs();const idx=docs.findIndex(d=>d.id===curIds[type]);if(idx===-1)return;
  docs[idx].title=document.getElementById('edTitle').value;
  docs[idx].content=document.getElementById('edBody').innerHTML;
  docs[idx].updated=new Date().toISOString();
  saveDocs(docs);document.getElementById('edSaveStatus').textContent='저장됨';updateWritingStats();
}
function delDoc(type,id,e){
  e.stopPropagation();if(!confirm('삭제할까요?'))return;
  let docs=allDocs().filter(d=>d.id!==id);saveDocs(docs);
  if(curIds[type]===id){const rem=docs.filter(d=>d.type===type);if(rem.length)loadDoc(type,rem[0].id);else{const nd=newDoc(type);loadDoc(type,nd.id)}}
  renderListPanel();updateWritingStats();
}

// ═══ Word Count ═══
function countS(html){const t=stripHtml(html);const c=t.replace(/\s/g,'').length;const w=t.trim()?t.trim().split(/\s+/).length:0;return{c,w,p:(c/200).toFixed(1)}}
function updateWC(){
  const{c,w,p}=countS(document.getElementById('edBody').innerHTML);
  document.getElementById('edChars').textContent=c.toLocaleString()+'자';
  document.getElementById('edWords').textContent=w.toLocaleString()+'단어';
  document.getElementById('edPages').textContent=p+'매';
}

// ═══ Books ═══
let curBookId=null;
function getBooks(){return L(K.books)||[]}
function saveBooks(b){S(K.books,b)}
function newBook(){curBookId=null;['book-title','book-author','book-publisher','book-pages'].forEach(id=>document.getElementById(id).value='');document.getElementById('book-body').innerHTML=''}
function saveBook(){
  const title=document.getElementById('book-title').value.trim();if(!title){alert('책 제목을 입력해주세요');return}
  const books=getBooks();
  const data={title,author:document.getElementById('book-author').value.trim(),publisher:document.getElementById('book-publisher').value.trim(),pages:parseInt(document.getElementById('book-pages').value)||0,memo:document.getElementById('book-body').innerHTML,date:today(),updated:new Date().toISOString()};
  if(curBookId){const idx=books.findIndex(b=>b.id===curBookId);if(idx!==-1)Object.assign(books[idx],data)}
  else{data.id=Date.now().toString();data.created=new Date().toISOString();books.unshift(data);curBookId=data.id}
  saveBooks(books);renderListPanel();renderBookMini();SYNC.saveBooksToSheet(data);
}
function loadBook(id){
  const b=getBooks().find(x=>x.id===id);if(!b)return;curBookId=id;
  document.getElementById('book-title').value=b.title;document.getElementById('book-author').value=b.author||'';
  document.getElementById('book-publisher').value=b.publisher||'';document.getElementById('book-pages').value=b.pages||'';
  document.getElementById('book-body').innerHTML=b.memo||'';renderListPanel();
}
function delBook(id,e){e.stopPropagation();if(!confirm('삭제할까요?'))return;saveBooks(getBooks().filter(b=>b.id!==id));renderListPanel();renderBookMini()}
function renderBookMini(){
  const books=getBooks().filter(b=>b.date&&(b.date===today()||isThisWeek(b.date))).slice(0,3);
  const el=document.getElementById('bookMiniList');
  if(!books.length){el.innerHTML='<div style="font-size:10px;color:var(--tx-m)">이번 주 기록 없음</div>';return}
  el.innerHTML=books.map(b=>'<div class="book-mini"><span class="book-mini-t">'+b.title+'</span><span class="book-mini-p">'+(b.pages?b.pages+'p':'')+'</span></div>').join('');
}

// ═══ Quotes ═══
function getQuotes(){return L(K.quotes)||[]}
function saveQuotes(q){S(K.quotes,q)}
function saveQuote(){
  const text=document.getElementById('quote-body').innerText.trim();if(!text)return;
  const by=document.getElementById('quote-by').value.trim();
  const quotes=getQuotes();quotes.unshift({id:Date.now().toString(),text,by,created:new Date().toISOString()});
  saveQuotes(quotes);newQuoteForm();renderListPanel();showRandomQuote();SYNC.saveQuotesToSheet(text,by);
}
function newQuoteForm(){document.getElementById('quote-body').innerHTML='';document.getElementById('quote-by').value=''}
function delQuote(id,e){e.stopPropagation();if(!confirm('삭제할까요?'))return;saveQuotes(getQuotes().filter(q=>q.id!==id));renderListPanel();showRandomQuote()}
function loadQuote(id){
  const q=getQuotes().find(x=>x.id===id);if(!q)return;
  document.getElementById('quote-body').innerText=q.text;document.getElementById('quote-by').value=q.by||'';
}
function showRandomQuote(){
  const quotes=getQuotes();
  if(!quotes.length){document.getElementById('rqText').textContent='어구록에 문장을 추가해보세요';document.getElementById('rqText').style.color='var(--tx-m)';document.getElementById('rqBy').textContent='';return}
  const q=quotes[Math.floor(Math.random()*quotes.length)];
  document.getElementById('rqText').textContent=q.text.length>80?q.text.slice(0,80)+'…':q.text;
  document.getElementById('rqText').style.color='var(--tx)';
  document.getElementById('rqBy').textContent=q.by?'— '+q.by:'';
}

// ═══ Memos ═══
let curMemoId=null;
function getMemos(){return L(K.memos)||[]}
function saveMemos(m){S(K.memos,m)}
function saveMemo(){
  const title=document.getElementById('memo-title').value.trim();const body=document.getElementById('memo-body').innerHTML;
  if(!title&&!stripHtml(body).trim())return;
  const memos=getMemos();
  if(curMemoId){const idx=memos.findIndex(m=>m.id===curMemoId);if(idx!==-1){memos[idx].title=title;memos[idx].content=body;memos[idx].updated=new Date().toISOString()}}
  else{const memo={id:Date.now().toString(),title,content:body,created:new Date().toISOString(),updated:new Date().toISOString()};memos.unshift(memo);curMemoId=memo.id}
  saveMemos(memos);renderListPanel();SYNC.saveMemosToSheet({title,content:stripHtml(body)});
}
function loadMemo(id){const m=getMemos().find(x=>x.id===id);if(!m)return;curMemoId=id;document.getElementById('memo-title').value=m.title||'';document.getElementById('memo-body').innerHTML=m.content||'';renderListPanel()}
function newMemoForm(){curMemoId=null;document.getElementById('memo-title').value='';document.getElementById('memo-body').innerHTML=''}
function delMemo(id,e){e.stopPropagation();if(!confirm('삭제할까요?'))return;saveMemos(getMemos().filter(m=>m.id!==id));renderListPanel()}

// ═══ Writing Stats ═══
function updateWritingStats(){
  const docs=allDocs().filter(d=>d.type==='fiction');const td=today();const wd=getWeekDates();
  let tT=0,tW=0,tA=0;
  docs.forEach(d=>{const c=stripHtml(d.content).replace(/\s/g,'').length;const dt=d.updated?.slice(0,10)||d.created?.slice(0,10);tA+=c;if(dt===td)tT+=c;if(wd.includes(dt))tW+=c});
  document.getElementById('wToday').textContent=(tT/200).toFixed(1);
  document.getElementById('wWeek').textContent=(tW/200).toFixed(1);
  document.getElementById('wTotal').textContent=(tA/200).toFixed(1);
  document.getElementById('wBar').style.width=Math.min(100,(tT/200)/10*100)+'%';
}

// ═══ Tab Switch ═══
function switchTab(t){
  if(textTypes.includes(activeTab))saveCurDoc(activeTab);
  activeTab=t;
  document.querySelectorAll('.lp-tab').forEach(el=>el.classList.toggle('on',el.dataset.t===t));
  document.getElementById('editorText').style.display=textTypes.includes(t)?'flex':'none';
  document.getElementById('editorBook').style.display=t==='book'?'flex':'none';
  document.getElementById('editorQuote').style.display=t==='quote'?'flex':'none';
  document.getElementById('editorMemo').style.display=t==='memo'?'flex':'none';
  document.getElementById('edToolbar').style.display=['book','quote'].includes(t)?'none':'flex';
  document.getElementById('edChars').parentElement.style.display=textTypes.includes(t)?'flex':'none';
  document.getElementById('lpSaveBtn').style.display=['book','quote','memo'].includes(t)?'block':'none';
  if(textTypes.includes(t)){const docs=getDocs(t);if(curIds[t])loadDoc(t,curIds[t]);else if(docs.length)loadDoc(t,docs[0].id);else{const nd=newDoc(t);loadDoc(t,nd.id)}}
  if(t==='book'){if(curBookId)loadBook(curBookId);else{const b=getBooks();if(b.length)loadBook(b[0].id);else newBook()}}
  if(t==='memo'){if(curMemoId)loadMemo(curMemoId);else{const m=getMemos();if(m.length)loadMemo(m[0].id);else newMemoForm()}}
  renderListPanel();
}

// ═══ List Panel ═══
function renderListPanel(){
  const t=activeTab,el=document.getElementById('lpList');
  if(textTypes.includes(t)){
    const docs=getDocs(t);
    if(!docs.length){el.innerHTML='<div style="text-align:center;padding:40px 14px;color:var(--tx-m);font-size:12px">아직 글이 없습니다</div>';return}
    el.innerHTML=docs.map(d=>'<div class="lp-item '+(curIds[t]===d.id?'on':'')+'" onclick="loadDoc(\''+t+'\',\''+d.id+'\')"><div class="lp-item-title">'+(d.title||'제목 없음')+'</div><div class="lp-item-date">'+fmtDate(d.created)+'</div>'+(stripHtml(d.content).slice(0,60)?'<div class="lp-item-preview">'+stripHtml(d.content).slice(0,60)+'</div>':'')+'<button class="lp-item-del" onclick="delDoc(\''+t+'\',\''+d.id+'\',event)">✕</button></div>').join('');
  } else if(t==='book'){
    const books=getBooks();
    if(!books.length){el.innerHTML='<div style="text-align:center;padding:40px 14px;color:var(--tx-m);font-size:12px">등록된 책이 없습니다</div>';return}
    el.innerHTML=books.map(b=>'<div class="lp-item '+(curBookId===b.id?'on':'')+'" onclick="loadBook(\''+b.id+'\')"><div class="lp-item-title">'+b.title+'</div><div class="lp-item-date">'+(b.author||'')+((b.publisher)?' · '+b.publisher:'')+'</div><button class="lp-item-del" onclick="delBook(\''+b.id+'\',event)">✕</button></div>').join('');
  } else if(t==='quote'){
    const quotes=getQuotes();
    if(!quotes.length){el.innerHTML='<div style="text-align:center;padding:40px 14px;color:var(--tx-m);font-size:12px">어구록이 비어있습니다</div>';return}
    el.innerHTML=quotes.map(q=>'<div class="lp-item" onclick="loadQuote(\''+q.id+'\')"><div class="lp-item-preview" style="white-space:normal;font-family:\'Noto Serif KR\',serif;line-height:1.6;color:var(--tx);font-size:12px">'+q.text.slice(0,100)+(q.text.length>100?'...':'')+'</div>'+(q.by?'<div class="lp-item-date" style="margin-top:3px">'+q.by+'</div>':'')+'<button class="lp-item-del" onclick="delQuote(\''+q.id+'\',event)">✕</button></div>').join('');
  } else if(t==='memo'){
    const memos=getMemos();
    if(!memos.length){el.innerHTML='<div style="text-align:center;padding:40px 14px;color:var(--tx-m);font-size:12px">메모가 없습니다</div>';return}
    el.innerHTML=memos.map(m=>'<div class="lp-item '+(curMemoId===m.id?'on':'')+'" onclick="loadMemo(\''+m.id+'\')"><div class="lp-item-title">'+(m.title||'제목 없음')+'</div><div class="lp-item-date">'+fmtDate(m.created)+'</div><button class="lp-item-del" onclick="delMemo(\''+m.id+'\',event)">✕</button></div>').join('');
  }
}

// ═══ Toolbar ═══
function execCmd(cmd,val){
  const target=activeTab==='memo'?document.getElementById('memo-body'):document.getElementById('edBody');
  target.focus();
  if(cmd==='formatBlock'&&val)document.execCommand(cmd,false,'<'+val+'>');
  else document.execCommand(cmd,false,val||null);
}

// ═══ Actions ═══
function handleNew(){
  const t=activeTab;
  if(textTypes.includes(t)){const nd=newDoc(t);loadDoc(t,nd.id)}
  else if(t==='book')newBook();
  else if(t==='quote')newQuoteForm();
  else if(t==='memo')newMemoForm();
  renderListPanel();
}
function handleSave(){
  const t=activeTab;
  if(textTypes.includes(t)){saveCurDoc(t);SYNC.scheduleDocSave(t)}
  else if(t==='book')saveBook();
  else if(t==='quote')saveQuote();
  else if(t==='memo')saveMemo();
}

// ═══ GAS Sync ═══
const GAS_URL='https://script.google.com/macros/s/AKfycbysOb_XZi1k1FkhGhki9XqKraC-I5YMvpdSIBpcfUxDXtq7J9Nd-JcodVk5fM_78z4/exec';
const SYNC={
  timer:null,checksTimer:null,checksSaving:false,checksPending:false,lastChecksPayload:'',
  setSyncStatus(text,type){const el=document.getElementById('syncStatus');if(el){el.textContent=text;el.className='sync-status '+(type||'')}},
  async saveDocToGDrive(type,title,content){
    if(!GAS_URL||!stripHtml(content).trim())return;
    try{this.setSyncStatus('동기화 중...','syncing');await this._post({action:'save_doc',type,title:title||today(),content:stripHtml(content)});this.setSyncStatus('Drive 저장 완료','ok');setTimeout(()=>this.setSyncStatus('Google Drive 연결됨','ok'),2000)}catch(e){console.error(e);this.setSyncStatus('저장 실패','error')}
  },
  scheduleChecksSave(){clearTimeout(this.checksTimer);this.checksTimer=setTimeout(()=>this.saveChecksToSheet(),400)},
  async saveChecksToSheet(){
    if(!GAS_URL)return;const p={action:'save_routine',date:today(),checks:getChk()};const pk=JSON.stringify(p);
    if(this.checksSaving){this.checksPending=true;return}if(pk===this.lastChecksPayload)return;
    this.checksSaving=true;try{await this._post(p);this.lastChecksPayload=pk}catch(e){console.error(e)}finally{this.checksSaving=false;if(this.checksPending){this.checksPending=false;this.scheduleChecksSave()}}
  },
  async saveQuotesToSheet(text,by){if(!GAS_URL)return;try{await this._post({action:'save_quote',text:text||'',by:by||''})}catch(e){console.error(e)}},
  async saveBooksToSheet(book){if(!GAS_URL||!book)return;try{await this._post({action:'save_doc',type:'book',title:book.title,content:'저자: '+(book.author||'')+'\n출판사: '+(book.publisher||'')+'\n읽은 양: '+(book.pages||0)+'p\n\n'+stripHtml(book.memo||'')})}catch(e){console.error(e)}},
  async saveMemosToSheet(memo){if(!GAS_URL||!memo)return;try{await this._post({action:'save_doc',type:'memo',title:memo.title||'메모',content:memo.content||''})}catch(e){console.error(e)}},
  async _post(data){await fetch(GAS_URL,{method:'POST',mode:'no-cors',cache:'no-store',headers:{'Content-Type':'text/plain;charset=utf-8'},body:JSON.stringify(data)});return{status:'sent'}},
  scheduleDocSave(type){clearTimeout(this.timer);this.timer=setTimeout(()=>{if(!curIds[type])return;const doc=allDocs().find(d=>d.id===curIds[type]);if(doc&&stripHtml(doc.content).trim())this.saveDocToGDrive(type,doc.title,doc.content)},5000)},
  async syncAll(){
    this.setSyncStatus('전체 동기화 중...','syncing');
    for(const type of textTypes){if(curIds[type]){const doc=allDocs().find(d=>d.id===curIds[type]);if(doc&&stripHtml(doc.content).trim())await this.saveDocToGDrive(type,doc.title,doc.content)}}
    this.setSyncStatus('전체 동기화 완료','ok');setTimeout(()=>this.setSyncStatus('Google Drive 연결됨','ok'),2000)
  }
};

// ═══ Auto-save ═══
let _at=null;
function setupAutoSave(){
  const body=document.getElementById('edBody'),title=document.getElementById('edTitle');
  const onInput=()=>{document.getElementById('edSaveStatus').textContent='저장 중...';clearTimeout(_at);_at=setTimeout(()=>{if(textTypes.includes(activeTab)){saveCurDoc(activeTab);SYNC.scheduleDocSave(activeTab)}},800);updateWC()};
  body.addEventListener('input',onInput);title.addEventListener('input',onInput);
  // Memo auto-save
  const mb=document.getElementById('memo-body'),mt=document.getElementById('memo-title');
  const memoInput=()=>{clearTimeout(_at);_at=setTimeout(()=>{if(activeTab==='memo')saveMemo()},1500)};
  mb.addEventListener('input',memoInput);mt.addEventListener('input',memoInput);
}

// ═══ Keyboard shortcuts ═══
document.addEventListener('keydown',e=>{if((e.ctrlKey||e.metaKey)&&e.key==='s'){e.preventDefault();handleSave()}});

// ═══ Init ═══
function init(){
  renderChk();renderBookMini();showRandomQuote();updateWritingStats();setupAutoSave();
  // Load first doc for navi
  const naviDocs=getDocs('navi');
  if(naviDocs.length)loadDoc('navi',naviDocs[0].id);else{const nd=newDoc('navi');loadDoc('navi',nd.id)}
  if(GAS_URL)SYNC.setSyncStatus('Google Drive 연결됨','ok');else SYNC.setSyncStatus('로컬 전용','');
}
init();
</script>
</body>
</html>
