 (cd "$(git rev-parse --show-toplevel)" && git apply --3way <<'EOF' 
diff --git a/docs/google-sheet-duplicate-fix.md b/docs/google-sheet-duplicate-fix.md
new file mode 100644
index 0000000000000000000000000000000000000000..63e362477f0ebce0687a2c8a5346fd87c6fb8acb
--- /dev/null
+++ b/docs/google-sheet-duplicate-fix.md
@@ -0,0 +1,74 @@
+# 루틴 중복 행(같은 날짜 여러 줄) 근본 해결 가이드
+
+현재 프론트엔드에서 요청을 줄여도, **Apps Script 쪽에서 동시에 2개 요청이 들어오면** `appendRow`가 중복 실행될 수 있습니다.
+
+가장 안전한 방법은 아래 2가지입니다.
+
+1. `LockService`로 동시 실행 잠금
+2. `appendRow` 대신 **날짜 기준 upsert(있으면 수정, 없으면 추가)**
+
+---
+
+## 교체할 Apps Script 함수
+
+아래 함수로 `saveRoutineToSheet`를 교체하세요.
+
+```javascript
+function saveRoutineToSheet(dateStr, checks) {
+  var lock = LockService.getScriptLock();
+  lock.waitLock(30000);
+
+  try {
+    var ss = SpreadsheetApp.openById('17D4UIrkBSFOxF2bwoaoOXo6aYfemPEtv2WeSz07Ei1M');
+    var sheet = ss.getActiveSheet();
+
+    var items = ['exercise', 'vitamin', 'english', 'japanese', 'drawing', 'ukulele', 'nodrink'];
+    var rowValues = [dateStr].concat(items.map(function(id) {
+      return checks && checks[id] ? 'O' : '';
+    }));
+
+    // 날짜 문자열 비교는 표시값으로 고정 (Date/문자열 혼합 방지)
+    var lastRow = sheet.getLastRow();
+    var targetRow = -1;
+
+    if (lastRow >= 2) {
+      var dateDisplayValues = sheet.getRange(2, 1, lastRow - 1, 1).getDisplayValues();
+      for (var i = 0; i < dateDisplayValues.length; i++) {
+        if (dateDisplayValues[i][0] === dateStr) {
+          targetRow = i + 2;
+          break;
+        }
+      }
+    }
+
+    if (targetRow === -1) {
+      sheet.appendRow(rowValues);
+      targetRow = sheet.getLastRow();
+    } else {
+      sheet.getRange(targetRow, 1, 1, rowValues.length).setValues([rowValues]);
+    }
+
+    return { status: 'updated', date: dateStr, row: targetRow };
+  } finally {
+    lock.releaseLock();
+  }
+}
+```
+
+---
+
+## 왜 이 방식이 안전한가?
+
+- 기존 방식: 같은 날짜 기존 행을 지우고 `appendRow` → 동시 요청 시 둘 다 append할 수 있음
+- 변경 방식: 잠금 + 한 행에 `setValues`로 덮어쓰기 → 같은 날짜는 항상 한 줄 유지
+
+---
+
+## 적용 순서
+
+1. Apps Script 편집기에서 함수 교체
+2. `doPost`는 그대로 유지 (`save_routine` 분기 사용)
+3. 배포(웹 앱)에서 **새 버전 배포**
+4. 사이트에서 체크 2~3번 연속 후 시트 확인
+
+필요하면 이 저장소의 프론트엔드 디바운스/직렬화 로직과 함께 사용하세요.
 
EOF
)
